{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5f855b2-7344-44ad-bf8b-75bccd63d288","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5c39255c-3916-4924-9c71-84e774ccb654","typeOfStateId":"state","$connId":"con_3","$id":"0787d17e-55da-4436-aa10-d0a48e299a22","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"destinyBlock"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"92b6c275-1194-4f79-b026-d56754803aad","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"flow\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        const { flow } = JSON.parse(input); \n        \n        return flow;\n    } catch (ex) {\n        return \"vazio\"\n    }\n}","inputVariables":["input.content"],"outputVariable":"flow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ad63f220-dfcd-4c51-acb9-f12d9996b697","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"destinyBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        const { destinyBlock } = JSON.parse(input);\n\n        if (!destinyBlock) return \"default\";\n\n        return destinyBlock;\n    } catch (ex) {\n        return \"default\";\n    };\n};","inputVariables":["input.content"],"outputVariable":"destinyBlock","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":false}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c39255c-3916-4924-9c71-84e774ccb654","$invalid":false,"typeOfStateId":"state"},"id":"onboarding","root":true,"$position":{"top":"219px","left":"1510px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-cbaab6ad-b191-4777-9711-49ea5e4ec807","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-0f7e1741-074a-44fe-be1b-f59fc51032a4","label":"UserInput","background":"#000000","canChangeBackground":false}]},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"95b10ba8-e351-4d16-9b10-ce14961cb1fd","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ff11452d-5194-48c3-8745-969f248fbd53","typeOfStateId":"state","$connId":"con_8","$id":"d12c38ac-e523-4382-a3ac-eb9376d78ec9","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"41300612-e787-4688-bc4c-91335397a7b7","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastBlock\" to blip variable \"state.previous.name\"","$invalid":false,"settings":{"variable":"lastBlock","value":"{{state.previous.name}}"},"conditions":[]},{"$id":"c82238fd-7041-4e38-8300-7ae3646d3f89","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(input, inputType) {\n    const userInput = {\n        'input': input || 'vazio',\n        'type': input ? inputType : 'vazio'\n    }\n\n    return JSON.stringify(userInput)\n}","inputVariables":["input.content","input.type"],"outputVariable":"userInput"},"conditions":[]},{"$id":"4b24f533-4cd6-422f-bc6c-43bb9d9b898e","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"flow\"","$invalid":false,"settings":{"function":"run","source":"function run(identifierFlow, lastBlock) {\n    const flow = {\n        \"origin\": identifierFlow,\n        \"blockOrigin\": lastBlock\n    }\n\n    return JSON.stringify(flow)\n}","inputVariables":["application.identifier","lastBlock"],"outputVariable":"flow"},"conditions":[]},{"$id":"9d8558f5-e642-4e58-abc6-410d42cbc7c4","$typeOfContent":"","type":"SetVariable","$title":"Set \"true\" to variable \"inatividade\"","$invalid":false,"settings":{"variable":"inatividade","value":"true"},"conditions":[{"source":"input","comparison":"notExists","values":[]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ff11452d-5194-48c3-8745-969f248fbd53","$invalid":false,"typeOfStateId":"state"},"id":"fallback","$position":{"top":"76.25px","left":"2665.5px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-e044a243-5b55-4b38-bd07-56d1989679a9","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7765bd8a-854f-4089-a925-d0ac608b0031","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false}]},"ff11452d-5194-48c3-8745-969f248fbd53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3ddc7104-69d0-43de-b3fd-0a30f0a6458c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1ae5fcb1-d1de-41cd-a2d9-f7e2a54bf2ad","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"ff11452d-5194-48c3-8745-969f248fbd53","root":false,"$title":"[Go to] Cascata de Valiacao","$position":{"top":"208px","left":"2666px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5c39255c-3916-4924-9c71-84e774ccb654":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17d2d1b2-6dc7-4757-8d11-670235777543","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0aa2a38b-67a1-478a-93ba-96dc3cc74c00","typeOfStateId":"state","$connId":"con_13","$id":"8a0239d9-8d3a-4735-9eb7-f4b23a16c51d","conditions":[{"source":"context","comparison":"notEquals","values":["default"],"variable":"destinyBlock"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"134beeb2-2425-4710-97fd-163c71a109d8","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"5c39255c-3916-4924-9c71-84e774ccb654","root":false,"$title":"[Logic only] Check redirect","$position":{"top":"85px","left":"1511px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0aa2a38b-67a1-478a-93ba-96dc3cc74c00":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8261fe0-c103-40b3-9392-27d6fc6dff28","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirectToBlock}}","typeOfStateId":"variable","$id":"7a7ce857-3bcc-4a8e-bf14-2a31d6a9df11","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"redirectToBlock"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9f4d290a-d206-4bf1-bf36-db9c4451eb54","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"redirectToBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(returnBlock, persistentReturn, errorType) {\n    const block = JSON.parse(returnBlock)\n\n    if (errorType === 'api') return block.blocoAnterior \n\n    if (persistentReturn === \"true\" && (!errorType.includes(\"dinamico\")))  return block.blocoAnterior\n\n    return block.default\n}","inputVariables":["returnBlock","persistentReturn","errorType"],"outputVariable":"redirectToBlock"},"conditions":[]},{"$id":"379854bc-7941-4cbe-a4c5-5ff3550ac5b4","$typeOfContent":"","type":"SetVariable","$title":"Set \"false\" to variable \"persistentReturn\"","$invalid":false,"settings":{"variable":"persistentReturn","value":"false"},"conditions":[{"values":[],"source":"context","variable":"persistentReturn","comparison":"exists"},{"values":["true"],"source":"context","variable":"persistentReturn","comparison":"equals"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false},{"id":"blip-tag-6135b34d-d325-4e1f-8c13-1b64385b6912","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-ab10cd5f-75c0-4810-bae8-20f451463e59","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"0aa2a38b-67a1-478a-93ba-96dc3cc74c00","root":false,"$title":"[Go to] Mapped block","$position":{"top":"87px","left":"1704px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"1ae5fcb1-d1de-41cd-a2d9-f7e2a54bf2ad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3ddc7104-69d0-43de-b3fd-0a30f0a6458c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"4d654f96-3d29-4651-b8b9-55ebbc3ccf8b","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput, flow) {\n    try {\n        userInput = JSON.parse(userInput)\n        flow = JSON.parse(flow)\n\n        const redirectMessage = {\n            service: \"cascataValidacao\",\n            input: userInput,\n            flow,\n            destinyBlock: \"default\"\n        }\n\n        return JSON.stringify(redirectMessage)\n    } catch (error) {\n        const redirectMessage = {\n            service: \"cascataValidacao\",\n            input: { \"input\": \"vazio\", \"type\": \"vazio\" },\n            flow: { \"origin\": \"vazio\", \"blockOrigin\": \"vazio\" },\n            destinyBlock: \"default\"\n        }\n\n        return JSON.stringify(redirectMessage)\n    }\n}","inputVariables":["userInput","flow"],"outputVariable":"redirectMessage"},"conditions":[]}],"$leavingCustomActions":[{"$id":"fed6de02-4c5c-42b7-8ccf-eb2f9b018acd","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"cascataValidacao\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-351458ff-2b12-4b66-a113-a919034eba5e","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-b20ff123-d928-45d9-aa20-682b725acd33","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1ae5fcb1-d1de-41cd-a2d9-f7e2a54bf2ad","root":false,"$title":"[Redirect to] Cascata de Validacao","$position":{"top":"54px","left":"785px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"f8807e7e-3d26-47d3-a7ac-295a9105b2f0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0551ffa8-107c-4550-8a11-3313e66ab5d5","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const redirectMessage = {\n        service: \"algoMais\",\n        destinyBlock: \"default\",\n    }\n    \n    return JSON.stringify(redirectMessage)\n}","inputVariables":[],"outputVariable":"redirectMessage"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d590a51c-5cdb-4d64-b0fe-165e94ee8dba","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"algoMais\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d96a4042-bb47-47e4-9838-234ca15e592e","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-55787041-c6da-49b6-8e14-de45b5669835","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"f8807e7e-3d26-47d3-a7ac-295a9105b2f0","root":false,"$title":"[Redirect to] Algo Mais","$position":{"top":"227px","left":"785px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f3c332a1-db4a-48e0-9158-1ce33ef067f9":{"$contentActions":[{"action":{"$id":"c9bdfce6-e048-403e-9d20-29df64ac8d23","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"085307e7-3c7d-451c-9998-c7c5e6fce756","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"085307e7-3c7d-451c-9998-c7c5e6fce756","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a2169f39-9fa2-417e-a885-29ed29deb139","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3ca705c7-918c-4e39-85de-25521ff11364","type":"text/plain","content":"{{iaResponse}}","metadata":{}},"$cardContent":{"document":{"id":"3ca705c7-918c-4e39-85de-25521ff11364","type":"text/plain","content":"{{iaResponse}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a5e5b914-caa3-4ade-973a-4d3fd00a04a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"b6b73ca7-1d93-4565-9702-70db075d6206","typeOfStateId":"state","$connId":"con_18","$id":"cff34a79-01b2-44a7-aa6d-578085a75b53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"dd047eb9-acd3-45ab-a9be-1025476a6dfb","$typeOfContent":"","type":"TrackEvent","$title":"resposta ia exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"resposta ia exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"b6b73ca7-1d93-4565-9702-70db075d6206","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-68457ddf-1051-4139-8970-d5727d28a1ec","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b5335a16-e3c5-44c4-81e7-c135fa941bd4","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"f3c332a1-db4a-48e0-9158-1ce33ef067f9","root":false,"$title":"[C.0.0.3] [Msg]","$position":{"top":"690px","left":"1275px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b6b73ca7-1d93-4565-9702-70db075d6206":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5e5b914-caa3-4ade-973a-4d3fd00a04a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"8fcf987b-e63c-4f85-8cbc-54e538857277","typeOfStateId":"state","$connId":"con_23","$id":"924e04c3-2731-44dc-833f-5adceb9bfa0e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9c37898e-7e5d-48cc-ba87-141bd86ac825","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"generico"},"conditions":[]},{"$id":"fc694a30-7e72-4b53-8b56-0e693be28981","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]}],"$leavingCustomActions":[{"$id":"71758f69-00f5-442e-90df-744b2450d1e1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade');\n\n        if (userContentType !== 'text/plain') {\n            throw new Error('input inesperado');\n        }\n\n        const inputTrimmed = userContent.trim();\n\n        if (inputTrimmed.length < 3 || inputTrimmed.length > 100) {\n            throw new Error('tamanho inválido');\n        }\n\n        const ALPHANUMERIC_REG = /[a-zA-Z0-9à-ÿÀ-Ÿ]/;\n        if (!ALPHANUMERIC_REG.test(inputTrimmed)) {\n            throw new Error('apenas caracteres especiais');\n        }\n\n        return JSON.stringify({\n            success: true,\n            data: inputTrimmed, \n            input: inputTrimmed,\n            message: 'válido'\n        });\n\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || \"\",\n            message: 'inválido'\n        });\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput"},"conditions":[]},{"$id":"1953d90c-3b7d-43a4-889f-257b29435316","$typeOfContent":"","type":"TrackEvent","$title":"cadastro input","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro input","action":"{{processedInput@input}} | {{processedInput@message}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-2d75b1e3-e351-4cd8-9a85-42f4840cf645","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-3ff7ece6-8576-4854-8c24-54fb4f56d561","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-6955ab94-6dae-4f3f-8727-4cf17fe0413e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-2d2b4238-f90f-43c5-87be-f053ab52c66c","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"b6b73ca7-1d93-4565-9702-70db075d6206","root":false,"$title":"[C.0.0.3] [Input]","$position":{"top":"813px","left":"1274px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8fcf987b-e63c-4f85-8cbc-54e538857277":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"97aee914-34ae-4c35-a7b6-87699b268842","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"97721cad-8840-4af4-a0db-191f01d8c944","typeOfStateId":"state","$connId":"con_28","$id":"4e7455d9-bcc7-4598-ac64-d2106154415c","conditions":[{"source":"context","comparison":"contains","values":["[CADASTRO_COMPLETO]"],"variable":"iaResponse"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"f3c332a1-db4a-48e0-9158-1ce33ef067f9","typeOfStateId":"state","$connId":"con_33","$id":"affd7a55-5505-4691-8ce3-cc7c5946e45c","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusRequestColetaDados"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"d0c95e93-18fe-4e65-bb13-9282873043e0","$typeOfContent":"","type":"ProcessHttp","$title":"[POST] Coleta dados","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Bearer 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"},"method":"POST","body":"{\r\n  \"model\": \"llama-3.3-70b-versatile\",\r\n  \"messages\": [\r\n    {\r\n      \"role\": \"system\",\r\n      \"content\": \"Você é o Atlas da AtlasX. Seu ÚNICO objetivo é coletar: Nome, Email, Rua, Número, Bairro, Cidade, Estado e CEP. Não peça CPF ou Telefone.\\n\\n### REGRAS:\\n1. Se os dados estiverem completos, exiba um resumo e pergunte: 'As informações estão corretas?'.\\n2. Assim que o usuário confirmar, sua resposta deve conter APENAS: 'Perfeito! Vou seguir com seu cadastro.' seguido do bloco:\\n\\n[DADOS]\\nNome: valor_real\\nEmail: valor_real\\nRua: valor_real\\nNumero: valor_real\\nBairro: valor_real\\nCidade: valor_real\\nEstado: valor_real\\nCEP: valor_real\\n[CADASTRO_COMPLETO]\"\r\n    },\r\n    {\r\n      \"role\": \"user\",\r\n      \"content\": \"Histórico: {{iaResponse}}\\nEntrada atual: {{processedInput@data}}\"\r\n    }\r\n  ],\r\n  \"temperature\": 0.1\r\n}","uri":"https://api.groq.com/openai/v1/chat/completions","responseStatusVariable":"statusRequestColetaDados","responseBodyVariable":"responseRequestColetaDados"},"conditions":[]},{"$id":"562fc0e6-4d85-441a-a0b0-daf70214fd4a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"iaResponse\"","$invalid":false,"settings":{"function":"run","source":"function run(response) {\n    try {\n        const jsonResponse = JSON.parse(response);\n        \n        if (jsonResponse.choices && jsonResponse.choices[0].message.content) {\n            var text = jsonResponse.choices[0].message.content;\n            return text.trim();\n        }\n\n        return \"IA não retornou conteúdo válido.\";\n\n    } catch (e) {\n        return \"Erro ao processar JSON do Groq\";\n    }\n}","inputVariables":["responseRequestColetaDados"],"outputVariable":"iaResponse"},"conditions":[]},{"$id":"df37200d-07ef-4585-9e30-bf2e32b497cc","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"api"},"conditions":[]},{"$id":"5302805a-4b45-4559-86e4-3f70276a3fe9","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]},{"$id":"6a9051a4-b415-4e42-b4d6-18f713325341","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"TrackEvent","$title":"Chamada de api","$invalid":false,"settings":{"extras":{},"category":"Chamada de api","action":"Coleta dados | {{statusRequestColetaDados}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"2590d7d7-e9ec-47a8-84ba-9e2ac7b65b88","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"dadosParaCadastro\"","$invalid":false,"settings":{"function":"run","source":"function run(responseIA, taxDocument, tipoUsuario) {\n    try {\n        const regex = /Nome:\\s*(.*)\\nEmail:\\s*(.*)\\nRua:\\s*(.*)\\nNumero:\\s*(.*)\\nBairro:\\s*(.*)\\nCidade:\\s*(.*)\\nEstado:\\s*(.*)\\nCEP:\\s*(.*)/i;\n        const match = responseIA.match(regex);\n\n        if (match) {\n            const idLimpo = taxDocument.replace(/\\D/g, '');\n            const idTipo = (tipoUsuario === \"Pessoa Física\") ? \"cpf\" : \"cnpj\";\n\n            const payload = {\n                \"operation\": \"criar\",\n                \"id\": idLimpo,\n                \"id_tipo\": idTipo,\n                \"nome\": match[1].trim(),\n                \"email\": match[2].trim(),\n                \"rua\": match[3].trim(),\n                \"numero\": match[4].trim(),\n                \"bairro\": match[5].trim(),\n                \"cidade\": match[6].trim(),\n                \"estado\": match[7].trim(),\n                \"cep\": match[8].trim()\n            };\n\n            return JSON.stringify(payload);\n        }\n        \n        return JSON.stringify({ \"operation\": \"erro\", \"detalhe\": \"Formato de dados inválido\" });\n\n    } catch (e) {\n        return JSON.stringify({ \"operation\": \"erro\", \"detalhe\": e.message });\n    }\n}","inputVariables":["iaResponse","contact.taxDocument","tipoUsuario"],"outputVariable":"dadosParaCadastro"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7c12a917-f4b9-4c41-a7aa-1edd81dad8c2","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-832c0ce5-9765-49e5-8bdf-3fb1b7c8e432","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-72850cc5-9073-4673-8baa-973b30c0f215","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-7a790905-b341-4d87-be45-8d6d7f6435f1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"8fcf987b-e63c-4f85-8cbc-54e538857277","root":false,"$title":"[C.0.0.2] [Request Http] Groq Versatile","$position":{"top":"728px","left":"1515px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#e91e63","commentsIdList":[]}},"97721cad-8840-4af4-a0db-191f01d8c944":{"$contentActions":[{"action":{"$id":"422453ce-dcd9-45c2-8f19-47d29a4718dd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f091ec53-8919-4990-9339-fdc17a129c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f091ec53-8919-4990-9339-fdc17a129c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0c0b5906-8887-4c44-90bc-30f756ac385d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"730b76c7-4276-4444-abed-d7525ab6a861","type":"text/plain","content":"Perfeito!!! ⭐\n\nVou seguir com seu cadastro, só um instante.","metadata":{}},"$cardContent":{"document":{"id":"730b76c7-4276-4444-abed-d7525ab6a861","type":"text/plain","content":"Perfeito!!! ⭐\n\nVou seguir com seu cadastro, só um instante."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"11b3b46c-7b3f-4ac3-ae11-0a85e9d07679","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"ecdb89ac-392e-4052-a2c5-3f099994ee8e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"ecdb89ac-392e-4052-a2c5-3f099994ee8e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"897beb0c-4033-4c79-b871-aa47c2a99b94","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"9145a9e7-52ef-4e7d-bdb7-c93f411ac154","type":"text/plain","content":"⏰ Cadastrando...","metadata":{}},"$cardContent":{"document":{"id":"9145a9e7-52ef-4e7d-bdb7-c93f411ac154","type":"text/plain","content":"⏰ Cadastrando..."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6e7092c3-42fe-4b76-8abb-e7d44da69326","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5f71fc7a-de60-40b6-b996-fb9999fb04d4","typeOfStateId":"state","$connId":"con_38","$id":"bf70d83a-96e9-4c66-ae28-a391c9a5968c","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af75393-ba4b-49b6-ac0f-c8334c450348","$typeOfContent":"","type":"TrackEvent","$title":"Informacoes coletadas exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"Informacoes coletadas exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-b8b53b43-1cff-4747-b08a-7d3b8389ca40","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-adc4b570-45a3-44cf-b718-7fd27d666e52","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"97721cad-8840-4af4-a0db-191f01d8c944","root":false,"$title":"[C.0.0.3] [Msg]","$position":{"top":"753px","left":"1729px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"134beeb2-2425-4710-97fd-163c71a109d8":{"$contentActions":[{"action":{"$id":"422453ce-dcd9-45c2-8f19-47d29a4718dd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f091ec53-8919-4990-9339-fdc17a129c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f091ec53-8919-4990-9339-fdc17a129c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0c0b5906-8887-4c44-90bc-30f756ac385d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"730b76c7-4276-4444-abed-d7525ab6a861","type":"text/plain","content":"Vamos fazer isso agora! É rapidinho. ✨\n\nPoderia me informar o seu {{bo}}Nome Completo{{bc}}, seu {{bo}}E-mail{{bc}} e o seu {{bo}}Endereço de entrega{{bc}} (contendo Rua, Número, Bairro, Cidade, Estado e CEP)?","metadata":{}},"$cardContent":{"document":{"id":"730b76c7-4276-4444-abed-d7525ab6a861","type":"text/plain","content":"Vamos fazer isso agora! É rapidinho. ✨\n\nPoderia me informar o seu {{bo}}Nome Completo{{bc}}, seu {{bo}}E-mail{{bc}} e o seu {{bo}}Endereço de entrega{{bc}} (contendo Rua, Número, Bairro, Cidade, Estado e CEP)?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6e7092c3-42fe-4b76-8abb-e7d44da69326","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"1751cd3a-8b04-4adc-bfb8-c692df203826","typeOfStateId":"state","$connId":"con_43","$id":"fc927231-bf0d-4e60-9689-5d1723595faa","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af75393-ba4b-49b6-ac0f-c8334c450348","$typeOfContent":"","type":"TrackEvent","$title":"cadastro exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-be491b42-d114-4616-a6ea-608602cfabbd","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-f6a6de39-be6b-4751-89c9-e7883f0142b9","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"134beeb2-2425-4710-97fd-163c71a109d8","root":false,"$title":"[C.0.0.1] [Msg]","$position":{"top":"405px","left":"1515px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"5f71fc7a-de60-40b6-b996-fb9999fb04d4":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"97aee914-34ae-4c35-a7b6-87699b268842","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"24aa4897-2f5d-4539-9c14-330e0da928b7","typeOfStateId":"state","$connId":"con_48","$id":"54b383a7-9028-4ab6-9f7b-66c3eed7018e","conditions":[{"source":"context","comparison":"startsWith","values":["2"],"variable":"statusRequestCriarCadastro"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"d0c95e93-18fe-4e65-bb13-9282873043e0","$typeOfContent":"","type":"ProcessHttp","$title":"[POST] Criar Cadastro","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Bearer {{accessToken}}","x-api-key":"47jq64bv79jslemfcjj4f1ttv6"},"method":"POST","body":"{{dadosParaCadastro}}","uri":"https://2zcwa01sbi.execute-api.us-east-1.amazonaws.com/default/nova_carteira_dev","responseStatusVariable":"statusRequestCriarCadastro","responseBodyVariable":"responseRequestCriarCadastro"},"conditions":[]},{"$id":"df37200d-07ef-4585-9e30-bf2e32b497cc","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"api"},"conditions":[]},{"$id":"5302805a-4b45-4559-86e4-3f70276a3fe9","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]},{"$id":"c9ac8bee-07bf-498c-8768-89c8376e7e56","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"TrackEvent","$title":"Chamada de api","$invalid":false,"settings":{"extras":{},"category":"Chamada de api","action":"Criar Cadastro| {{statusRequestCriarCadastro}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-62b0bc4c-99ec-455f-b8ee-cd201f411580","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-53f05049-00a0-4588-9c22-2ff33c8b2635","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-bb1cf062-f021-4323-b80a-f35b6d3d48d3","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-e48ac428-bdc7-417d-af0a-bbdd2ecb9f43","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"5f71fc7a-de60-40b6-b996-fb9999fb04d4","root":false,"$title":"[C.0.0.7] [Request Http] Criar Cadastro","$position":{"top":"913px","left":"1729px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#e91e63","commentsIdList":[]}},"24aa4897-2f5d-4539-9c14-330e0da928b7":{"$contentActions":[{"action":{"$id":"422453ce-dcd9-45c2-8f19-47d29a4718dd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"f091ec53-8919-4990-9339-fdc17a129c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"f091ec53-8919-4990-9339-fdc17a129c0b","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0c0b5906-8887-4c44-90bc-30f756ac385d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"730b76c7-4276-4444-abed-d7525ab6a861","type":"text/plain","content":"Seu cadastro foi concluído com sucesso!!\n\nÉ um prazer ter você conosco.","metadata":{}},"$cardContent":{"document":{"id":"730b76c7-4276-4444-abed-d7525ab6a861","type":"text/plain","content":"Seu cadastro foi concluído com sucesso!!\n\nÉ um prazer ter você conosco."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"6e7092c3-42fe-4b76-8abb-e7d44da69326","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fc7b9aac-aef5-4e40-a7e2-e2cc89893e0e","typeOfStateId":"state","$connId":"con_53","$id":"f4df809d-73c8-406e-813a-a0ea4628770e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"0af75393-ba4b-49b6-ac0f-c8334c450348","$typeOfContent":"","type":"TrackEvent","$title":"sucesso cadastro exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"sucesso cadastro exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-9b23093e-fa99-422f-9b79-177213b18b5c","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-252ef0a6-23ac-48eb-8a59-73e117c6b78f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"24aa4897-2f5d-4539-9c14-330e0da928b7","root":false,"$title":"[C.0.0.8] [Msg]","$position":{"top":"1102px","left":"1729px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"fc7b9aac-aef5-4e40-a7e2-e2cc89893e0e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90d6c37b-1a39-479a-8822-7bc99d6e0437","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f8807e7e-3d26-47d3-a7ac-295a9105b2f0","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"fc7b9aac-aef5-4e40-a7e2-e2cc89893e0e","root":false,"$title":"[Go to] [Redirect to] Algo Mais","$position":{"top":"1244px","left":"1729px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"1751cd3a-8b04-4adc-bfb8-c692df203826":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5e5b914-caa3-4ade-973a-4d3fd00a04a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"8fcf987b-e63c-4f85-8cbc-54e538857277","typeOfStateId":"state","$connId":"con_58","$id":"924e04c3-2731-44dc-833f-5adceb9bfa0e","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9c37898e-7e5d-48cc-ba87-141bd86ac825","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"generico"},"conditions":[]},{"$id":"fc694a30-7e72-4b53-8b56-0e693be28981","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]}],"$leavingCustomActions":[{"$id":"71758f69-00f5-442e-90df-744b2450d1e1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade');\n\n        if (userContentType !== 'text/plain') {\n            throw new Error('input inesperado');\n        }\n\n        const inputTrimmed = userContent.trim();\n\n        if (inputTrimmed.length < 3 || inputTrimmed.length > 100) {\n            throw new Error('tamanho inválido');\n        }\n\n        const ALPHANUMERIC_REG = /[a-zA-Z0-9à-ÿÀ-Ÿ]/;\n        if (!ALPHANUMERIC_REG.test(inputTrimmed)) {\n            throw new Error('apenas caracteres especiais');\n        }\n\n        return JSON.stringify({\n            success: true,\n            data: inputTrimmed, \n            input: inputTrimmed,\n            message: 'válido'\n        });\n\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || \"\",\n            message: 'inválido'\n        });\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput"},"conditions":[]},{"$id":"52eace71-3d56-459c-a4a8-370444564004","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"iaResponse\"","$invalid":false,"settings":{"function":"run","source":"function run(iaResponse) {\n    if (!iaResponse || iaResponse.includes(\"iaResponse\")) {\n        return \"Início da conversa\";\n    }\n    \n    return iaResponse.length > 1000 ? iaResponse.slice(-1000) : iaResponse;\n}","inputVariables":[],"outputVariable":"iaResponse"},"conditions":[]},{"$id":"1953d90c-3b7d-43a4-889f-257b29435316","$typeOfContent":"","type":"TrackEvent","$title":"cadastro input","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro input","action":"{{processedInput@input}} | {{processedInput@message}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-575640a3-f6e9-4d13-a7bf-9ffb40bd4202","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-637eeb0a-6fb9-438d-9625-71a62128a66d","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-f73fe7e3-f5b7-4eac-be02-2c6be4117d58","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-21eeea8a-738f-4e5d-a81c-f9dfdf76b021","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"1751cd3a-8b04-4adc-bfb8-c692df203826","root":false,"$title":"[C.0.0.1] [Input]","$position":{"top":"541px","left":"1515px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}