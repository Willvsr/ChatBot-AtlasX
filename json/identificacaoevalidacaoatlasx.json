{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5f855b2-7344-44ad-bf8b-75bccd63d288","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"5c39255c-3916-4924-9c71-84e774ccb654","typeOfStateId":"state","$connId":"con_3","$id":"0787d17e-55da-4436-aa10-d0a48e299a22","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"destinyBlock"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"92b6c275-1194-4f79-b026-d56754803aad","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"flow\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        const { flow } = JSON.parse(input); \n        \n        return flow;\n    } catch (ex) {\n        return \"vazio\"\n    }\n}","inputVariables":["input.content"],"outputVariable":"flow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"ad63f220-dfcd-4c51-acb9-f12d9996b697","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"destinyBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        const { destinyBlock } = JSON.parse(input);\n\n        if (!destinyBlock) return \"default\";\n\n        return destinyBlock;\n    } catch (ex) {\n        return \"default\";\n    };\n};","inputVariables":["input.content"],"outputVariable":"destinyBlock","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":false}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5c39255c-3916-4924-9c71-84e774ccb654","$invalid":false,"typeOfStateId":"state"},"id":"onboarding","root":true,"$position":{"top":"219px","left":"1510px"},"$title":"Início","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-3c350952-bc26-4253-a918-8c0b0611996a","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-71a789f3-3655-4f3b-946e-0cea20171078","label":"UserInput","background":"#000000","canChangeBackground":false}]},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"95b10ba8-e351-4d16-9b10-ce14961cb1fd","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right"},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"ff11452d-5194-48c3-8745-969f248fbd53","typeOfStateId":"state","$connId":"con_8","$id":"d12c38ac-e523-4382-a3ac-eb9376d78ec9","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"41300612-e787-4688-bc4c-91335397a7b7","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastBlock\" to blip variable \"state.previous.name\"","$invalid":false,"settings":{"variable":"lastBlock","value":"{{state.previous.name}}"},"conditions":[]},{"$id":"c82238fd-7041-4e38-8300-7ae3646d3f89","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(input, inputType) {\n    const userInput = {\n        'input': input || 'vazio',\n        'type': input ? inputType : 'vazio'\n    }\n\n    return JSON.stringify(userInput)\n}","inputVariables":["input.content","input.type"],"outputVariable":"userInput"},"conditions":[]},{"$id":"4b24f533-4cd6-422f-bc6c-43bb9d9b898e","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"flow\"","$invalid":false,"settings":{"function":"run","source":"function run(identifierFlow, lastBlock) {\n    const flow = {\n        \"origin\": identifierFlow,\n        \"blockOrigin\": lastBlock\n    }\n\n    return JSON.stringify(flow)\n}","inputVariables":["application.identifier","lastBlock"],"outputVariable":"flow"},"conditions":[]},{"$id":"9d8558f5-e642-4e58-abc6-410d42cbc7c4","$typeOfContent":"","type":"SetVariable","$title":"Set \"true\" to variable \"inatividade\"","$invalid":false,"settings":{"variable":"inatividade","value":"true"},"conditions":[{"source":"input","comparison":"notExists","values":[]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"ff11452d-5194-48c3-8745-969f248fbd53","$invalid":false,"typeOfStateId":"state"},"id":"fallback","$position":{"top":"76.25px","left":"2663px"},"$title":"Exceções","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"$tags":[{"id":"blip-tag-87144f9b-8f1a-4962-a970-21b1a08eadbc","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-41fb8a29-36d2-4907-8fa2-d3f8ebb892fe","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false}]},"ff11452d-5194-48c3-8745-969f248fbd53":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3ddc7104-69d0-43de-b3fd-0a30f0a6458c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1ae5fcb1-d1de-41cd-a2d9-f7e2a54bf2ad","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"ff11452d-5194-48c3-8745-969f248fbd53","root":false,"$title":"[Go to] Cascata de Valiacao","$position":{"top":"213px","left":"2663px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"5c39255c-3916-4924-9c71-84e774ccb654":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17d2d1b2-6dc7-4757-8d11-670235777543","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"0aa2a38b-67a1-478a-93ba-96dc3cc74c00","typeOfStateId":"state","$connId":"con_13","$id":"8a0239d9-8d3a-4735-9eb7-f4b23a16c51d","conditions":[{"source":"context","comparison":"notEquals","values":["default"],"variable":"destinyBlock"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"705eb4dd-c303-47c6-8580-7494b3595221","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"5c39255c-3916-4924-9c71-84e774ccb654","root":false,"$title":"[Logic only] Check redirect","$position":{"top":"85px","left":"1511px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0aa2a38b-67a1-478a-93ba-96dc3cc74c00":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8261fe0-c103-40b3-9392-27d6fc6dff28","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"{{redirectToBlock}}","typeOfStateId":"variable","$id":"7a7ce857-3bcc-4a8e-bf14-2a31d6a9df11","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"redirectToBlock"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9f4d290a-d206-4bf1-bf36-db9c4451eb54","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"redirectToBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(returnBlock, persistentReturn, errorType) {\n    const block = JSON.parse(returnBlock)\n\n    if (errorType === 'api') return block.blocoAnterior \n\n    if (persistentReturn === \"true\" && (!errorType.includes(\"dinamico\")))  return block.blocoAnterior\n\n    return block.default\n}","inputVariables":["returnBlock","persistentReturn","errorType"],"outputVariable":"redirectToBlock"},"conditions":[]},{"$id":"379854bc-7941-4cbe-a4c5-5ff3550ac5b4","$typeOfContent":"","type":"SetVariable","$title":"Set \"false\" to variable \"persistentReturn\"","$invalid":false,"settings":{"variable":"persistentReturn","value":"false"},"conditions":[{"values":[],"source":"context","variable":"persistentReturn","comparison":"exists"},{"values":["true"],"source":"context","variable":"persistentReturn","comparison":"equals"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false},{"id":"blip-tag-d3f26f74-9330-4bfa-ac5a-9075277ade8c","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-841bacad-cdd2-4a29-a411-a2b3c5802774","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"0aa2a38b-67a1-478a-93ba-96dc3cc74c00","root":false,"$title":"[Go to] Mapped block","$position":{"top":"87px","left":"1704px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"82d972b1-bdd6-4810-8706-a490e8e2f1eb":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"f0cd2fc9-07b3-44ef-9598-40910e345c46","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const redirectMessage = {\n        service: \"finalizacao\",\n        destinyBlock: \"default\",\n    }\n    \n    return JSON.stringify(redirectMessage)\n}","inputVariables":[],"outputVariable":"redirectMessage"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d590a51c-5cdb-4d64-b0fe-165e94ee8dba","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"Finalizacao\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d694449f-aa51-4410-9b03-86f65be5ca38","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-5444736b-1d0e-4567-b413-60a964b10fb8","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"82d972b1-bdd6-4810-8706-a490e8e2f1eb","root":false,"$title":"[Redirect to] Finalizacao","$position":{"top":"211px","left":"786px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1ae5fcb1-d1de-41cd-a2d9-f7e2a54bf2ad":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"3ddc7104-69d0-43de-b3fd-0a30f0a6458c","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"4d654f96-3d29-4651-b8b9-55ebbc3ccf8b","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput, flow) {\n    try {\n        userInput = JSON.parse(userInput)\n        flow = JSON.parse(flow)\n\n        const redirectMessage = {\n            service: \"cascataValidacao\",\n            input: userInput,\n            flow,\n            destinyBlock: \"default\"\n        }\n\n        return JSON.stringify(redirectMessage)\n    } catch (error) {\n        const redirectMessage = {\n            service: \"cascataValidacao\",\n            input: { \"input\": \"vazio\", \"type\": \"vazio\" },\n            flow: { \"origin\": \"vazio\", \"blockOrigin\": \"vazio\" },\n            destinyBlock: \"default\"\n        }\n\n        return JSON.stringify(redirectMessage)\n    }\n}","inputVariables":["userInput","flow"],"outputVariable":"redirectMessage"},"conditions":[]}],"$leavingCustomActions":[{"$id":"fed6de02-4c5c-42b7-8ccf-eb2f9b018acd","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"cascataValidacao\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-c7373755-ff23-4083-b5ca-467e12c9f87d","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-0ec0c995-0a6d-4871-8c88-1c8401dd7be0","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1ae5fcb1-d1de-41cd-a2d9-f7e2a54bf2ad","root":false,"$title":"[Redirect to] Cascata de Validacao","$position":{"top":"53px","left":"786px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"fe669604-a53a-44ba-bd29-7038b3ed39a8":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"0551ffa8-107c-4550-8a11-3313e66ab5d5","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const redirectMessage = {\n        service: \"cadastro\",\n        destinyBlock: \"default\",\n    }\n    \n    return JSON.stringify(redirectMessage)\n}","inputVariables":[],"outputVariable":"redirectMessage"},"conditions":[]}],"$leavingCustomActions":[{"$id":"d590a51c-5cdb-4d64-b0fe-165e94ee8dba","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"cadastro\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a7e34718-8128-45db-a78a-54714f9ca312","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-a0d71231-e5c4-40dc-92f8-4ee9b14af127","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"fe669604-a53a-44ba-bd29-7038b3ed39a8","root":false,"$title":"[Redirect to] Cadastro","$position":{"top":"356px","left":"781px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"705eb4dd-c303-47c6-8580-7494b3595221":{"$contentActions":[{"action":{"$id":"c9bdfce6-e048-403e-9d20-29df64ac8d23","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"085307e7-3c7d-451c-9998-c7c5e6fce756","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"085307e7-3c7d-451c-9998-c7c5e6fce756","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a2169f39-9fa2-417e-a885-29ed29deb139","$typeOfContent":"text","type":"SendMessage","settings":{"id":"3ca705c7-918c-4e39-85de-25521ff11364","type":"text/plain","content":"Para eu localizar sua conta ou criar um novo cadastro, por favor, digite seu {{bo}}CPF ou CNPJ.{{bc}}","metadata":{}},"$cardContent":{"document":{"id":"3ca705c7-918c-4e39-85de-25521ff11364","type":"text/plain","content":"Para eu localizar sua conta ou criar um novo cadastro, por favor, digite seu {{bo}}CPF ou CNPJ.{{bc}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a5e5b914-caa3-4ade-973a-4d3fd00a04a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"47415aff-d813-40eb-a449-09817e9a7a10","typeOfStateId":"state","$connId":"con_18","$id":"cff34a79-01b2-44a7-aa6d-578085a75b53","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"dd047eb9-acd3-45ab-a9be-1025476a6dfb","$typeOfContent":"","type":"TrackEvent","$title":"localizar cpf cnpj exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"localizar cpf cnpj exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"47415aff-d813-40eb-a449-09817e9a7a10","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-aa8d285b-7ead-4501-8d64-d4b58a8eb992","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-3ecfeab5-a03f-46a8-b2f4-8381c882f37f","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"705eb4dd-c303-47c6-8580-7494b3595221","root":false,"$title":"[IV.0.0.1] [Msg]","$position":{"top":"360px","left":"1508px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"47415aff-d813-40eb-a449-09817e9a7a10":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a5e5b914-caa3-4ade-973a-4d3fd00a04a2","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"1c140625-f494-4c85-a2c4-a3ad5502a4af","typeOfStateId":"state","$connId":"con_23","$id":"93ee2b93-383e-47bd-8026-d632a128e06c","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"processedInput@success"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"9c37898e-7e5d-48cc-ba87-141bd86ac825","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"cpf cnpj"},"conditions":[]},{"$id":"fc694a30-7e72-4b53-8b56-0e693be28981","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]}],"$leavingCustomActions":[{"$id":"71758f69-00f5-442e-90df-744b2450d1e1","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade');\n        if (userContentType !== 'text/plain') throw new Error('input inesperado');\n\n        const cleanInput = userContent.replace(/\\D/g, '');\n\n        let isValid = false;\n        let tipoUsuario = \"\";\n        let formattedData = \"\";\n\n        if (cleanInput.length === 11) {\n            isValid = validarCPF(cleanInput);\n            tipoUsuario = \"Pessoa Física\";\n            formattedData = formatarCPF(cleanInput);\n        } else if (cleanInput.length === 14) {\n            isValid = validarCNPJ(cleanInput);\n            tipoUsuario = \"Pessoa Jurídica\";\n            formattedData = formatarCNPJ(cleanInput);\n        } else {\n            throw new Error('documento inválido');\n        }\n\n        if (!isValid) throw new Error('documento inválido');\n\n        return JSON.stringify({\n            success: true,\n            tipoUsuario: tipoUsuario,\n            data: formattedData,\n            input: userContent,\n            message: 'válido'\n        });\n\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || \"\",\n            message: 'inválido'\n        });\n    }\n\n\n    function validarCPF(cpf) {\n        if (/^(\\d)\\1+$/.test(cpf)) return false;\n        let soma = 0, resto;\n        for (let i = 1; i <= 9; i++) soma += parseInt(cpf.substring(i - 1, i)) * (11 - i);\n        resto = (soma * 10) % 11;\n        if ((resto === 10) || (resto === 11)) resto = 0;\n        if (resto !== parseInt(cpf.substring(9, 10))) return false;\n        soma = 0;\n        for (let i = 1; i <= 10; i++) soma += parseInt(cpf.substring(i - 1, i)) * (12 - i);\n        resto = (soma * 10) % 11;\n        if ((resto === 10) || (resto === 11)) resto = 0;\n        if (resto !== parseInt(cpf.substring(10, 11))) return false;\n        return true;\n    }\n\n    function validarCNPJ(cnpj) {\n        if (/^(\\d)\\1+$/.test(cnpj)) return false;\n        let tamanho = cnpj.length - 2;\n        let numeros = cnpj.substring(0, tamanho);\n        let digitos = cnpj.substring(tamanho);\n        let soma = 0, pos = tamanho - 7;\n        for (let i = tamanho; i >= 1; i--) {\n            soma += numeros.charAt(tamanho - i) * pos--;\n            if (pos < 2) pos = 9;\n        }\n        let resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);\n        if (resultado != digitos.charAt(0)) return false;\n        tamanho = tamanho + 1;\n        numeros = cnpj.substring(0, tamanho);\n        soma = 0;\n        pos = tamanho - 7;\n        for (let i = tamanho; i >= 1; i--) {\n            soma += numeros.charAt(tamanho - i) * pos--;\n            if (pos < 2) pos = 9;\n        }\n        resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);\n        if (resultado != digitos.charAt(1)) return false;\n        return true;\n    }\n\n    function formatarCPF(v) {\n        return v.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, \"$1.$2.$3-$4\");\n    }\n\n    function formatarCNPJ(v) {\n        return v.replace(/(\\d{2})(\\d{3})(\\d{3})(\\d{4})(\\d{2})/, \"$1.$2.$3/$4-$5\");\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput"},"conditions":[]},{"$id":"d568eb3f-e30d-46bb-8afa-cffde6178c32","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"MergeContact","$title":"Set contact variable \"taxDocument\"","$invalid":false,"settings":{"extras":{},"taxDocument":"{{processedInput@data}}"},"conditions":[{"source":"context","variable":"processedInput@success","comparison":"equals","values":["true"]}]},{"$id":"cd9f9926-d35b-4e50-b79e-4aca4ad516b7","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SetVariable","$title":"set variavable \"tipoUsuario\"","$invalid":false,"settings":{"variable":"tipoUsuario","value":"{{processedInput@tipoUsuario}}"},"conditions":[]},{"$id":"1953d90c-3b7d-43a4-889f-257b29435316","$typeOfContent":"","type":"TrackEvent","$title":"pergunta nome saudacao input","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"pergunta nome saudacao input","action":"{{processedInput@input}} | {{processedInput@message}}"},"conditions":[]},{"$id":"c4a831d2-a363-4e53-ae0f-4b25d732a54e","$typeOfContent":"","type":"TrackEvent","$title":"pergunta nome saudacao inesperado","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"pergunta nome saudacao inesperado","action":"{{processedInput@input}}"},"conditions":[{"source":"context","variable":"processedInput@message","comparison":"equals","values":["inválido"]},{"source":"context","variable":"processedInput@input","comparison":"exists","values":[]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-af2f558c-95ff-4c7c-b0d7-6d75bafb331b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-9dff765a-a757-44a4-84f5-d10f06bce271","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-624ec81b-525e-4fa4-8edb-b5a49513557c","label":"MergeContact","background":"#FF1E90","canChangeBackground":false},{"id":"blip-tag-1abc4879-b5ed-4eac-8a1b-24d441f3b76b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-196c0d6a-3069-4eaa-b6a2-8831fd536eab","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"47415aff-d813-40eb-a449-09817e9a7a10","root":false,"$title":"[IV.0.0.1] [Input] [Val]","$position":{"top":"498px","left":"1508px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1c140625-f494-4c85-a2c4-a3ad5502a4af":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"97aee914-34ae-4c35-a7b6-87699b268842","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"7d9ea64e-e4f2-4358-ae77-33a55969189e","typeOfStateId":"state","$connId":"con_28","$id":"17aea315-69ca-4ead-b164-74a58b8510a5","conditions":[{"source":"context","comparison":"equals","values":["200"],"variable":"statusRequestSearchCpfCnpj"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"312b0784-46fa-453c-a784-19a7213fcab6","typeOfStateId":"state","$connId":"con_33","$id":"75de816d-e52d-4a1d-91c9-2cf136bc486f","conditions":[{"source":"context","comparison":"equals","values":["404"],"variable":"statusRequestSearchCpfCnpj"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"c6d087d6-f147-4c07-bd2c-9ffb70bb669a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ProcessHttp","$title":"[POST] Auth","$invalid":false,"settings":{"headers":{"Content-Type":"application/x-www-form-urlencoded"},"method":"POST","body":"grant_type=client_credentials&client_id=47jq64bv79jslemfcjj4f1ttv6&client_secret=2va4bdh06o35emluvnbihc5k6ll1il5mgm6iku0fuqenjhj9ggm","uri":"https://us-east-1cr8lbvmvb.auth.us-east-1.amazoncognito.com/oauth2/token","responseBodyVariable":"authResponse","responseStatusVariable":"authStatus"},"conditions":[]},{"$id":"7f5c66c0-ee83-4052-9427-767e425ec02d","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"accessToken\"","$invalid":false,"settings":{"function":"run","source":"function run(authResponse) {\n    try {\n        const response = JSON.parse(authResponse);\n        return response.access_token;\n    } catch (e) {\n        return null;\n    }\n}","inputVariables":["authResponse"],"outputVariable":"accessToken"},"conditions":[]},{"$id":"7d4df447-a461-4851-9d6c-6a9ae85e781a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"bodyRequest\"","$invalid":false,"settings":{"function":"run","source":"function run(tipoUsuario, taxDocument) {\n    const idLimpo = taxDocument.replace(/\\D/g, '');\n    \n    const idTipo = (tipoUsuario === \"Pessoa Física\") ? \"cpf\" : \"cnpj\";\n\n    const bodyRequest = {\n        \"operation\": \"buscar\",\n        \"id\": idLimpo,\n        \"id_tipo\": idTipo,\n        \"format\": \"upper\"\n    };\n\n    return JSON.stringify(bodyRequest);\n}","inputVariables":["tipoUsuario","contact.taxDocument"],"outputVariable":"bodyRequest"},"conditions":[]},{"$id":"d0c95e93-18fe-4e65-bb13-9282873043e0","$typeOfContent":"","type":"ProcessHttp","$title":"[POST] Buscar por CPF ou CNPJ","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Bearer {{accessToken}}","x-api-key":"47jq64bv79jslemfcjj4f1ttv6"},"method":"POST","body":"{{bodyRequest}}","uri":"https://2zcwa01sbi.execute-api.us-east-1.amazonaws.com/default/nova_carteira_dev","responseStatusVariable":"statusRequestSearchCpfCnpj","responseBodyVariable":"responseRequestSearchCpfCnpj"},"conditions":[]},{"$id":"df37200d-07ef-4585-9e30-bf2e32b497cc","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"api"},"conditions":[]},{"$id":"5302805a-4b45-4559-86e4-3f70276a3fe9","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]},{"$id":"a1acfe51-3c96-422c-adcc-d3c50089145d","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"TrackEvent","$title":"Chamada de api","$invalid":false,"settings":{"extras":{},"category":"Chamada de api","action":"Buscar por CPF ou CNPJ | {{statusRequestSearchCpfCnpj}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"f51a8e54-1b91-4cab-bc41-e3d427f7ec1e","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"dadosUsuario\"","$invalid":false,"settings":{"function":"run","source":"function run(responseRequestBusca) {\n    try {\n        const response = JSON.parse(responseRequestBusca);\n        \n        if (response.sucesso && response.data && response.data.length > 0) {\n            const dadosOriginais = response.data[0];\n            \n            const chaveNome = Object.keys(dadosOriginais).find(key => \n                key.toLowerCase() === 'nome'\n            );\n\n            return JSON.stringify({\n                encontrado: true,\n                nomeIdentificado: chaveNome ? dadosOriginais[chaveNome] : \"Usuário\",\n                dadosCompletos: dadosOriginais\n            });\n        }\n        \n        return JSON.stringify({ encontrado: false });\n    } catch (e) {\n        return JSON.stringify({ encontrado: false, erro: \"Falha no processamento\" });\n    }\n}","inputVariables":["responseRequestSearchCpfCnpj"],"outputVariable":"dadosUsuario"},"conditions":[]},{"$id":"413bf14f-2c2a-4732-87e0-bbc4d8a4cc37","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"MergeContact","$title":"Set contact variable \"Nome\"","$invalid":false,"settings":{"extras":{},"name":"{{dadosUsuario@nomeIdentificado}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-b1eeb1af-d043-493e-ab86-083f9861a864","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-5ce3d9d8-f0a4-4393-8c8d-afa458700c36","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-06c2baec-0d05-4ec0-ac76-c6e99c298629","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-aab47ad6-cc23-400b-aacb-378ec52f0a5b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a7b24232-26cc-437e-b3e4-e48abf573916","label":"MergeContact","background":"#FF1E90","canChangeBackground":false}],"id":"1c140625-f494-4c85-a2c4-a3ad5502a4af","root":false,"$title":"[IV.0.0.3][Request Http] Buscar por CPF ou CNPJ","$position":{"top":"660px","left":"1508px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#e91e63","commentsIdList":[]}},"7d9ea64e-e4f2-4358-ae77-33a55969189e":{"$contentActions":[{"action":{"$id":"fa147b0b-3e41-4009-8671-7454c89718c4","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"b44e39a0-e536-43bd-bf44-bda2213eddc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b44e39a0-e536-43bd-bf44-bda2213eddc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f0c513bd-282a-4f4a-87e8-06efd4c7f3d0","$typeOfContent":"raw-content","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendRawMessage","settings":{"metadata":{},"type":"{{menuPayload@type}}","rawContent":"{{menuPayload@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1f655887-ce58-475f-9c95-886d737bf047","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"0ced7d5a-bf6e-4926-889d-cef3145efc7a","typeOfStateId":"state","$connId":"con_38","$id":"843433a4-477d-4cda-a4e7-3f228e99087e","conditions":[{"source":"context","comparison":"equals","values":["Nova consulta"],"variable":"processedInput@data"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"5f131c59-a093-4585-b1fa-f941ae16af2a","typeOfStateId":"state","$connId":"con_43","$id":"56eafa94-98b4-4c64-a6d2-332750e5f87f","conditions":[{"source":"context","comparison":"equals","values":["Finalizar conversa"],"variable":"processedInput@data"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"2ef282c5-18ce-4b65-bbde-4a1f66edb2e6","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"menuPayload\"","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(boldTags, platform, dadosUsuario) {\n    let platformInLowerCase = platform.toLowerCase()\n    \n    if (platformInLowerCase == 'instagram' || platformInLowerCase == 'telegram' || platformInLowerCase == 'messenger') {\n        platformInLowerCase = 'blipchat'\n    }\n\n    boldTags = JSON.parse(boldTags)\n\n    const { open, close } = boldTags\n    \n    let userName = \"usuário\"; \n    try {\n        const userObj = JSON.parse(dadosUsuario);\n        if (userObj && userObj.nomeIdentificado) {\n            userName = userObj.nomeIdentificado;\n        }\n    } catch (e) {\n        userName = \"usuário\";\n    }\n\n    const companyPhone = \"\"\n\n    const dynamicMenuBuildingDetails = {\n        \"text\": `Encontrei seu cadastro! Que bom ter você de volta, ${open}${userName}${close}.\\n\\nO que deseja fazer agora??`,\n        \"header\": ``,\n        \"body\": `Encontrei seu cadastro! Que bom ter você de volta, ${open}${userName}${close}.\\n\\nO que deseja fazer agora??`,\n        \"footer\": '',\n        \"button\": '',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        \"options\": ['Nova consulta', 'Finalizar conversa'],\n        \"values\": ['Nova consulta', 'Finalizar conversa'],\n        \"description\": [],\n        \"payloadContact\": {\n            \"name\": '',\n            \"phone\": '',\n            \"company\":''\n        },\n        \"buttonsLink\":[\n            {\n                \"type\": '',\n                \"text\": '',\n                \"payload\": ''\n            },\n            {\n                \"type\": '',\n                \"text\": '',\n                \"payload\": ''\n            }\n        ],\n        \"menuScope\": {\n            \"whatsappButton\": true,\n            \"whatsappList\": false,\n            \"whatsappTemplate\": false,\n            \"whatsappContactMenu\": false,\n            \"blipchatQuickReply\": true,\n            \"blipchatMenu\": false,\n            \"blipchatButtonLink\": false,\n            \"defaultText\": false,\n            \"platform\": platformInLowerCase,\n            \"boldValue\": boldTags,\n        },\n    }\n\n    const dinamycMenuSchema = getMenuForPlatform(dynamicMenuBuildingDetails)\n\n    return dinamycMenuSchema\n}","inputVariables":["boldTags","platform","dadosUsuario"],"outputVariable":"menuPayload"},"conditions":[]},{"$id":"e07da8ab-3ef7-4976-be45-8d227ad4ed93","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"menu"},"conditions":[]},{"$id":"b4476379-2d84-4086-8bc0-fc44807f06da","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]},{"$id":"7fc2e355-7896-4960-9e85-b4efff6c7c5c","$typeOfContent":"","type":"TrackEvent","$title":"cadastro {{tipoUsuario}} encontrado exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro {{tipoUsuario}} encontrado exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"7a5f6eeb-1034-4aa5-b97f-ffefee8eba2b","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade')\n        \n        if (userContentType !== 'text/plain') {\n            userContent = JSON.parse(userContent)\n            \n            userContent = userContent['uri']\n            \n            throw new Error('input inesperado')\n        }\n\n        const menuOptions = {\n            \"1\": \"Nova consulta\",\n            \"2\": \"Finalizar conversa\"\n        }\n\n        const menuRegex = {\n            \"1\": \"^1$|^um$|^primeiro$|Nova consulta\",\n            \"2\": \"^2$|^dois$|^segundo$|Finalizar conversa\"\n        }\n\n        for (const prop in menuRegex) {\n            const regexOption = new RegExp(menuRegex[prop], \"igm\")\n\n            if (regexOption.test(userContent)) {\n\n                return JSON.stringify({\n                    success: true,\n                    data: menuOptions[prop],\n                    input: userContent,\n                    message: 'válido'\n                }, null, 2)\n            }\n        }\n\n        throw new Error('input inesperado')\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || error.message,\n            message: 'inválido'\n        }, null, 2)\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput"},"conditions":[]},{"$id":"0fdeef99-e0f3-4d7e-9931-cc92b16bfc67","$typeOfContent":"","type":"TrackEvent","$title":"cadastro {{tipoUsuario}} encontrado selecao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro {{tipoUsuario}} encontrado selecao","action":"{{processedInput@data}}"},"conditions":[]},{"$id":"e446625c-3e15-435d-8d0b-fa4be4883ed1","$typeOfContent":"","type":"TrackEvent","$title":"cadastro {{tipoUsuario}} encontrado inesperado","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro {{tipoUsuario}} encontrado inesperado","action":"{{processedInput@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"processedInput@data","values":["input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-ad9dbd4a-7d0a-458c-a21a-18ebd97a6e93","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-1b1e7317-ccc0-4229-b8fb-21218301c3a8","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-d8e98266-f597-4e40-93a9-4e840b93e7f2","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-490726e7-9e7a-4e37-90cc-cf0b9ae3946d","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-cb31100c-de59-4e47-be90-bd4fa5ec0918","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"7d9ea64e-e4f2-4358-ae77-33a55969189e","root":false,"$title":"[IV.0.0.4] [Menu] [Input] [Val]","$position":{"top":"870px","left":"1320px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"312b0784-46fa-453c-a784-19a7213fcab6":{"$contentActions":[{"action":{"$id":"fa147b0b-3e41-4009-8671-7454c89718c4","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"b44e39a0-e536-43bd-bf44-bda2213eddc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b44e39a0-e536-43bd-bf44-bda2213eddc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f0c513bd-282a-4f4a-87e8-06efd4c7f3d0","$typeOfContent":"raw-content","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendRawMessage","settings":{"metadata":{},"type":"{{menuPayload@type}}","rawContent":"{{menuPayload@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1f655887-ce58-475f-9c95-886d737bf047","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"1b4b70c5-e160-4ccf-8b0b-edb064cc56a9","typeOfStateId":"state","$connId":"con_48","$id":"f9545079-b768-473e-935f-f2b05d6b9696","conditions":[{"source":"context","comparison":"equals","values":["Cadastrar"],"variable":"processedInput@data"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"9e3179d6-240a-46d5-a85b-e56a83799e93","typeOfStateId":"state","$connId":"con_53","$id":"7b89fdf6-c953-4eb4-89e2-a35b70a21076","conditions":[{"source":"context","comparison":"equals","values":["Nova consulta"],"variable":"processedInput@data"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"1c8a72a4-1bb5-4712-9d19-0020e61d8b65","typeOfStateId":"state","$connId":"con_58","$id":"48a15f43-8361-4239-aba9-57ec1c75423b","conditions":[{"source":"context","comparison":"equals","values":["Finalizar conversa"],"variable":"processedInput@data"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"2ef282c5-18ce-4b65-bbde-4a1f66edb2e6","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"menuPayload\"","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(boldTags, platform) {\n    let platformInLowerCase = platform.toLowerCase()\n    \n    if (platformInLowerCase == 'instagram' || platformInLowerCase == 'telegram' || platformInLowerCase == 'messenger') {\n        platformInLowerCase = 'blipchat'\n    }\n\n\n    boldTags = JSON.parse(boldTags)\n\n    const { open, close } = boldTags\n\n    const companyPhone = \"\"\n\n    const dynamicMenuBuildingDetails = {\n        \"text\": `Você não está cadastrado no nosso sistema.\\n\\n${open}Como deseja prosseguir?${close}`,\n        \"header\": ``,\n        \"body\": ``,\n        \"footer\": '',\n        \"button\": '',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        \"options\": ['Cadastrar', 'Nova consulta', 'Finalizar conversa'],\n        \"values\": ['Cadastrar', 'Nova consulta', 'Finalizar conversa'],\n        \"description\": [],\n        \"payloadContact\": {\n            \"name\": '',\n            \"phone\": '',\n            \"company\":''\n        },\n        \"buttonsLink\":[\n            {\n                \"type\": '',\n                \"text\": '',\n                \"payload\": ''\n            },\n            {\n                \"type\": '',\n                \"text\": '',\n                \"payload\": ''\n            }\n        ],\n        \"menuScope\": {\n            \"whatsappButton\": true,\n            \"whatsappList\": false,\n            \"whatsappTemplate\": false,\n            \"whatsappContactMenu\": false,\n            \"blipchatQuickReply\": true,\n            \"blipchatMenu\": false,\n            \"blipchatButtonLink\": false,\n            \"defaultText\": false,\n            \"platform\": platformInLowerCase,\n            \"boldValue\": boldTags,\n        },\n    }\n\n    const dinamycMenuSchema = getMenuForPlatform(dynamicMenuBuildingDetails)\n\n    return dinamycMenuSchema\n}","inputVariables":["boldTags","platform"],"outputVariable":"menuPayload"},"conditions":[]},{"$id":"e07da8ab-3ef7-4976-be45-8d227ad4ed93","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"menu"},"conditions":[]},{"$id":"b4476379-2d84-4086-8bc0-fc44807f06da","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]},{"$id":"7fc2e355-7896-4960-9e85-b4efff6c7c5c","$typeOfContent":"","type":"TrackEvent","$title":"cadastro {{tipoUsuario}} nao encontrado exibicao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro {{tipoUsuario}} nao encontrado exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"7a5f6eeb-1034-4aa5-b97f-ffefee8eba2b","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade')\n        \n        if (userContentType !== 'text/plain') {\n            userContent = JSON.parse(userContent)\n            \n            userContent = userContent['uri']\n            \n            throw new Error('input inesperado')\n        }\n\n        const menuOptions = {\n            \"1\": \"Cadastrar\",\n            \"2\": \"Nova consulta\",\n            \"3\": \"Finalizar conversa\"\n        }\n\n        const menuRegex = {\n            \"1\": \"^1$|^um$|^primeiro$|Cadastrar\",\n            \"2\": \"^2$|^dois$|^segundo$|Nova consulta\",\n            \"3\":\"^3$|^tr[êe]s$|^terceiro$|Finalizar conversa\"\n        }\n\n        for (const prop in menuRegex) {\n            const regexOption = new RegExp(menuRegex[prop], \"igm\")\n\n            if (regexOption.test(userContent)) {\n\n                return JSON.stringify({\n                    success: true,\n                    data: menuOptions[prop],\n                    input: userContent,\n                    message: 'válido'\n                }, null, 2)\n            }\n        }\n\n        throw new Error('input inesperado')\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || error.message,\n            message: 'inválido'\n        }, null, 2)\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput"},"conditions":[]},{"$id":"0fdeef99-e0f3-4d7e-9931-cc92b16bfc67","$typeOfContent":"","type":"TrackEvent","$title":"cadastro {{tipoUsuario}} nao encontrado selecao","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro {{tipoUsuario}} nao encontrado selecao","action":"{{processedInput@data}}"},"conditions":[]},{"$id":"e446625c-3e15-435d-8d0b-fa4be4883ed1","$typeOfContent":"","type":"TrackEvent","$title":"cadastro {{tipoUsuario}} nao encontrado inesperado","$invalid":false,"settings":{"extras":{"Headline Anúncio":"{{metadata@headline}}","Id do Anúncio":"{{metadata@source_id}}","Url do Anúncio":"{{metadata@source_url}}"},"category":"cadastro {{tipoUsuario}} nao encontrado inesperado","action":"{{processedInput@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"processedInput@data","values":["input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"id":"blip-tag-c7b00226-44e1-4d12-9f43-f4b1be12a6d2","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-e45c9f50-4084-49cc-83fd-8fe0ad3118a2","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-1eaaeaf7-2845-42fd-9951-15a458f1b300","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-757be979-d903-4269-b381-c08eaa2b3319","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-ce542189-7784-40c0-bb8a-5adc0dd4b501","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"312b0784-46fa-453c-a784-19a7213fcab6","root":false,"$title":"[IV.0.0.5] [Menu] [Input] [Val]","$position":{"top":"870px","left":"1724px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"0ced7d5a-bf6e-4926-889d-cef3145efc7a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90d6c37b-1a39-479a-8822-7bc99d6e0437","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"705eb4dd-c303-47c6-8580-7494b3595221","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"0ced7d5a-bf6e-4926-889d-cef3145efc7a","root":false,"$title":"[Go to] [IV.0.0.1] [Msg]","$position":{"top":"870px","left":"1104px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"5f131c59-a093-4585-b1fa-f941ae16af2a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90d6c37b-1a39-479a-8822-7bc99d6e0437","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"82d972b1-bdd6-4810-8706-a490e8e2f1eb","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"5f131c59-a093-4585-b1fa-f941ae16af2a","root":false,"$title":"[Go to] [Redirect to] Finalizacao","$position":{"top":"1039px","left":"1320px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"1c8a72a4-1bb5-4712-9d19-0020e61d8b65":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90d6c37b-1a39-479a-8822-7bc99d6e0437","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"isAiGenerated":false,"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"1c8a72a4-1bb5-4712-9d19-0020e61d8b65","root":false,"$title":"[Go to] [Redirect to] Finalizacao","$position":{"top":"1035px","left":"1724px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"9e3179d6-240a-46d5-a85b-e56a83799e93":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90d6c37b-1a39-479a-8822-7bc99d6e0437","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"705eb4dd-c303-47c6-8580-7494b3595221","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"9e3179d6-240a-46d5-a85b-e56a83799e93","root":false,"$title":"[Go to] [IV.0.0.1] [Msg]","$position":{"top":"870px","left":"1927px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}},"1b4b70c5-e160-4ccf-8b0b-edb064cc56a9":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"90d6c37b-1a39-479a-8822-7bc99d6e0437","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fe669604-a53a-44ba-bd29-7038b3ed39a8","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false}],"id":"1b4b70c5-e160-4ccf-8b0b-edb064cc56a9","root":false,"$title":"[Go to] [Redirect to] Cadastro","$position":{"top":"715px","left":"1725px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]}}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}