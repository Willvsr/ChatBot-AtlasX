{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a306dad2-d76a-49b5-8ce0-44e735a317fb","type":"text/plain","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"fe8e538d-1a99-447a-9765-ada71bba64f0","typeOfStateId":"state","$connId":"con_3","$id":"fe86bc8d-92b4-41c4-acf3-2e64b4fe9f5a","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"781e42c9-99bf-429e-8d1d-33d873dd8867","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"flow\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        const { flow } = JSON.parse(input);\n       \n        return flow;\n    } catch (ex) {\n        return \"vazio\";\n    };\n};","inputVariables":["input.content"],"outputVariable":"flow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"9eccb068-2442-4679-9888-edf37e4bca26","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"destinyBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(input) {\n    try {\n        const { destinyBlock } = JSON.parse(input);\n        \n        if (!destinyBlock) {\n            return \"default\";\n        };\n\n        return destinyBlock;\n    } catch (ex) {\n        return \"default\";\n    };\n};","inputVariables":["input.content"],"outputVariable":"destinyBlock","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":false}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fe8e538d-1a99-447a-9765-ada71bba64f0","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"id":"blip-tag-ef91d071-b8f5-4ea3-b0ef-eab13811b258","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e26ab319-e9df-4168-823d-431516a1ce7d","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"InÃ­cio","$position":{"top":"265px","left":"630px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"85c44d23-8461-40b1-9006-826ad86a91e6","type":"text/plain","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"410d6094-629f-448f-a91f-1625fb226f37","typeOfStateId":"state","$connId":"con_8","$id":"ece35c52-0068-4fd1-8691-9c6c6bef78c8","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"1096532e-1527-4361-bf4e-291d4bcd6028","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastBlock\" to blip variable \"state.previous.name\"","$invalid":false,"settings":{"variable":"lastBlock","value":"{{state.previous.name}}"},"conditions":[]},{"$id":"5e770a3a-1757-4bec-8922-0729ce76c85e","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(input, inputType) {\n    const userInput = {\n        \"input\": input || \"vazio\",\n        \"type\": input ? inputType : \"vazio\"\n    };\n\n    return JSON.stringify(userInput);\n}","inputVariables":["input.content","input.type"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e7342847-0b0e-4e1f-9c6d-cdfd155b63c1","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"flow\"","$invalid":false,"settings":{"function":"run","source":"function run(identifierFlow, lastBlock) {\n    return {\n        \"origin\": identifierFlow,\n        \"blockOrigin\": lastBlock\n    };\n}","inputVariables":["application.identifier","lastBlock"],"outputVariable":"flow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"faaff52d-9263-4b21-abff-0e710224ee3f","$typeOfContent":"","type":"SetVariable","$title":"Set \"true\" to variable \"inatividade\"","$invalid":false,"settings":{"variable":"inatividade","value":"true"},"conditions":[{"source":"input","comparison":"notExists","values":[]}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"410d6094-629f-448f-a91f-1625fb226f37","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"id":"blip-tag-06e02846-bb2a-49a6-957e-d71b9a3efe3c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-db27e635-38ab-41fb-a929-089c9e64e9e9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"fallback","$title":"ExceÃ§Ãµes","$position":{"top":"244.714px","left":"1477.14px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:6db00a2d-e3d3-4809-93b2-cb2500a06fa6":{"$contentActions":[{"input":{"bypass":false,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Success"]}],"$cardContent":{"document":{"id":"22d21a94-a6c8-436e-aa05-ace3f6f25083","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"8963cda8-12f6-433c-8a6b-00a82ead2c9b","$connId":"con_13","$id":"7b57afa6-c548-4632-b880-38a56d96910a"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"8963cda8-12f6-433c-8a6b-00a82ead2c9b","$connId":"con_18","$id":"76ef09a2-6ef5-4b26-ab89-d080fea98c43"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"8963cda8-12f6-433c-8a6b-00a82ead2c9b","$connId":"con_23","$id":"8e4091df-550a-4224-849b-2770f70d74c8"},{"$isDeskOutput":true,"$isDeskDefaultOutput":true,"conditions":[{"source":"context","variable":"desk_forwardToDeskState_status","comparison":"equals","values":["Error"]}],"stateId":"fallback","$invalid":false},{"stateId":"8963cda8-12f6-433c-8a6b-00a82ead2c9b","typeOfStateId":"state","$connId":"con_28","$id":"59be5d88-a400-4b8b-b132-fdf6a91b0e5c","conditions":[{"source":"input","comparison":"contains","values":["Sair da fila"]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"2544ade8-7193-4f47-84a7-f3c70b16ac3c","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ForwardToDesk","conditions":[],"settings":{},"$invalid":false}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:6db00a2d-e3d3-4809-93b2-cb2500a06fa6","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"id":"blip-tag-ec119407-46e5-4f35-8202-cacdc4b9f3f6","label":"ForwardToDesk","background":"#5c9e70","canChangeBackground":false},{"id":"blip-tag-3d569d5e-90dd-43a1-9a25-250962e1e2fe","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"desk:6db00a2d-e3d3-4809-93b2-cb2500a06fa6","deskStateVersion":"3.0.0","root":false,"$title":"Atendimento humano","$afterStateChangedActions":[{"$id":"9e70a6d3-8ca2-444f-a9a8-55809c39880a","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"LeavingFromDesk","conditions":[],"settings":{}}],"$position":{"top":"842px","left":"622px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"be148021-6dd8-42c0-b03b-c50fe27cc62c":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"41724fba-ece9-4d02-8e3a-48fbf66bfe67","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e651c432-0dd7-47fe-a318-4ad0d99459c5","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-dcba5c87-a2d1-9fc6-9463-c3d1a11c9713","canChangeBackground":false}],"id":"be148021-6dd8-42c0-b03b-c50fe27cc62c","root":false,"$title":"[Go to] Pesquisa","$position":{"top":"1118px","left":"622px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"23166695-95e8-41e1-b4ec-eb0532a391ae":{"$contentActions":[{"action":{"$id":"859d340a-5fd7-495f-b928-c43b131a34f5","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"067ae515-b103-4e72-9034-9e5d75b583f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"067ae515-b103-4e72-9034-9e5d75b583f7","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b820f68c-17d6-4527-9501-40e8612d084b","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"01269b64-2b78-4272-98bd-e7a46db0723d","type":"text/plain","content":"Um atendente jÃ¡ estÃ¡ vindo te ajudar, tÃ¡ bom?\n\n{{bo}}Aguarde um momento, por favor.{{bc}}","metadata":{}},"$cardContent":{"document":{"id":"01269b64-2b78-4272-98bd-e7a46db0723d","type":"text/plain","content":"Um atendente jÃ¡ estÃ¡ vindo te ajudar, tÃ¡ bom?\n\n{{bo}}Aguarde um momento, por favor.{{bc}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3dc8eacd-9825-4148-8579-0e234990c330","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:6db00a2d-e3d3-4809-93b2-cb2500a06fa6","typeOfStateId":"state","$connId":"con_33","$id":"aca4601e-bc4e-40ce-9fb5-6c878dee82f0","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"0c99293d-4064-40c8-8667-9ca10b5d05ea","$typeOfContent":"","type":"TrackEvent","$title":"transbordo direcionamento exibicao","$invalid":false,"settings":{"extras":{"Headline AnÃºncio":"{{metadata@headline}}","Id do AnÃºncio":"{{metadata@source_id}}","Url do AnÃºncio":"{{metadata@source_url}}"},"category":"transbordo direcionamento exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"id":"blip-tag-7458457c-39d5-4fea-9f01-06b225917ff1","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-4dc002cf-8f55-4f92-9295-2c77853212f7","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"23166695-95e8-41e1-b4ec-eb0532a391ae","root":false,"$title":"[T.0.0.1] [Msg]","$position":{"top":"732px","left":"626px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"aad722dd-167d-4343-8dcc-65fd2a65e73d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a8261fe0-c103-40b3-9392-27d6fc6dff28","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1c643189-3e90-4d17-b98f-98882c5f21f9","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"redirectToBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(returnBlock, persistentReturn, errorType) {\n    const block = JSON.parse(returnBlock);\n\n    if (errorType === 'api') return block.blocoAnterior; \n\n    if (persistentReturn === \"true\" && (!errorType.includes(\"dinamico\")))  return block.blocoAnterior;\n\n    return block.default;\n}","inputVariables":["returnBlock","persistentReturn","errorType"],"outputVariable":"redirectToBlock","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":false},{"$id":"d74d9a5a-f903-475a-b05c-4b2a1dc55199","$typeOfContent":"","type":"SetVariable","$title":"Set \"false\" to variable \"persistentReturn\"","$invalid":false,"settings":{"variable":"persistentReturn","value":"false"},"conditions":[{"values":[],"source":"context","variable":"persistentReturn","comparison":"exists"},{"values":["true"],"source":"context","variable":"persistentReturn","comparison":"equals"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"$invalid":false,"typeOfStateId":"variable","stateId":"{{redirectToBlock}}"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-2b06d5cc-ddd3-00f4-3d13-04799dbf4d06","canChangeBackground":false},{"id":"blip-tag-e3c0abb5-9fb6-47a4-8715-507c7ea78502","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-d2972496-69a7-4ee2-897d-7978ebfe7e4d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"aad722dd-167d-4343-8dcc-65fd2a65e73d","root":false,"$title":"[Go to block with error]","$position":{"top":"140px","left":"819px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000","commentsIdList":[]},"isAiGenerated":false},"fe8e538d-1a99-447a-9765-ada71bba64f0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17d2d1b2-6dc7-4757-8d11-670235777543","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"aad722dd-167d-4343-8dcc-65fd2a65e73d","typeOfStateId":"state","$connId":"con_38","$id":"8a0239d9-8d3a-4735-9eb7-f4b23a16c51d","conditions":[{"source":"context","comparison":"notEquals","values":["default"],"variable":"destinyBlock"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"8e7b11ff-ac5b-40ec-b11e-ab78aaa83c74","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"fe8e538d-1a99-447a-9765-ada71bba64f0","root":false,"$title":"[Logic only] Check redirect","$position":{"top":"149px","left":"629px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"8963cda8-12f6-433c-8a6b-00a82ead2c9b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"17ba0971-2bc4-41b2-aa52-c281c64fb68c","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"be148021-6dd8-42c0-b03b-c50fe27cc62c","typeOfStateId":"state","$connId":"con_43","$id":"7e621bb2-0fed-487d-a15a-5972b5768a8d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"250b2035-3b85-4c06-ac76-09a47bf6d3b4","$typeOfContent":"","type":"SetVariable","$title":"Set variable \"atendimentJson\"","$invalid":false,"settings":{"variable":"atendimentJson","value":"{{input.content}}"},"conditions":[]},{"$id":"1218fedd-42bf-4cc2-acbb-171502998a89","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"atendimentData\"","$invalid":false,"settings":{"function":"run","source":"function run(atendimentJson) {\n  try {\n    if (!atendimentJson || !atendimentJson.includes(\"{\")) {\n      return JSON.stringify({ error: \"Entrada invÃ¡lida: Esperado objeto JSON.\" });\n    }\n\n    const { agentIdentity, sequentialId, tags, id, team } = JSON.parse(atendimentJson);\n\n    const agentName = formattedAgentName(agentIdentity);\n    let agentEmail = \"\";\n\n    if (agentIdentity && agentName !== \"Atendente\") {\n      agentEmail = agentIdentity.split(\"@\")[0].replace(\"%40\", \"@\");\n    }\n\n    let avaliatedTags = \"Ticket nÃ£o foi finalizado com tag\";\n    \n    if (Array.isArray(tags) && tags.length > 0) {\n        avaliatedTags = tags.length > 1 ? tags : tags[0];\n    }\n\n    const joinAtendimentInformation = {\n      id: id || \"N/A\",\n      sequentialId: sequentialId || \"N/A\",\n      agentName: agentName,\n      agentIdentity: agentEmail,\n      tags: avaliatedTags,\n      team: team || \"N/A\"\n    };\n\n    return JSON.stringify(joinAtendimentInformation);\n\n  } catch (e) {\n    return JSON.stringify({ \n        error: \"Falha ao processar dados\", \n        message: e.message \n    });\n  }\n}\n\nfunction formattedAgentName(identityAgent) {\n  if (!identityAgent || typeof identityAgent !== 'string') return \"Atendente\";\n\n  const getAgentName = identityAgent.split(\"%\")[0].split(\"@\")[0].split(\".\");\n\n  const organizeAgentName = getAgentName.map((name) => {\n    if (!name) return \"\";\n    const getFirsLetter = name.charAt(0).toUpperCase();\n    const restOfName = name.substring(1).toLowerCase(); \n\n    return `${getFirsLetter}${restOfName}`;\n  });\n\n  return organizeAgentName.join(\" \").trim();\n}","inputVariables":["atendimentJson"],"outputVariable":"atendimentData","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"be148021-6dd8-42c0-b03b-c50fe27cc62c","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-4ccd1b69-e861-430a-a4e7-7543113cdf31","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-ee4effe0-906b-4382-a0e4-a732b50ca5d1","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"8963cda8-12f6-433c-8a6b-00a82ead2c9b","root":false,"$title":"[Logic only] Pack service data","$position":{"top":"975px","left":"622px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"1c072a17-e5d4-4392-99ba-cd0aa10697f0":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"75c602a5-5d0c-4586-9208-55e88e77c15d","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput, flow) {\n    try {\n        userInput = JSON.parse(userInput)\n        flow = JSON.parse(flow)\n\n        const redirectMessage = {\n            service: \"cascataValidacao\",\n            input: userInput,\n            flow: flow,\n            destinyBlock: \"default\"\n        };\n\n        return JSON.stringify(redirectMessage);\n    } catch (error) {\n        const redirectMessage = {\n            service: \"cascataValidacao\",\n            input: { \"input\": \"vazio\", \"type\": \"vazio\" },\n            flow: { \"origin\": \"vazio\", \"blockOrigin\": \"vazio\" },\n            destinyBlock: \"default\"\n        };\n\n        return JSON.stringify(redirectMessage);\n    };\n};","inputVariables":["userInput","flow"],"outputVariable":"redirectMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"2e25f8b6-7537-4637-ae13-2779fe6e0bc4","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"Excecoes\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-59be08f8-1c22-42d3-9f4a-bd45e58c7514","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8a72aad3-aab0-4af5-b8fb-ef172751590b","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"1c072a17-e5d4-4392-99ba-cd0aa10697f0","root":false,"$title":"[Redirect to] Cascata de Validacao","$position":{"top":"383px","left":"133px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"410d6094-629f-448f-a91f-1625fb226f37":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"65db103d-641a-4c8b-bb75-6d06b84fb1d7","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"1c072a17-e5d4-4392-99ba-cd0aa10697f0","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-3a48ed69-4b58-b660-52bd-2bb0a3bf97db","canChangeBackground":false}],"id":"410d6094-629f-448f-a91f-1625fb226f37","root":false,"$title":"[Go to] Cascata de Valiacao","$position":{"top":"362px","left":"1478px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"b9e2adcf-0043-4925-9e29-bcb9ee9203ad":{"$contentActions":[{"action":{"$id":"15e65524-07cc-4415-8be5-b1aab953eab3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1f9fd1b7-2132-4eb3-9b57-a9c53140a987","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1f9fd1b7-2132-4eb3-9b57-a9c53140a987","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a5b5569e-a8f6-4cf9-9a36-bdc517178c85","$typeOfContent":"text","type":"SendMessage","settings":{"id":"46c9433e-2a34-40de-86bd-43ae077a04f5","type":"text/plain","content":"Nosso time {{bo}}nÃ£o estÃ¡ em horÃ¡rio de atendimento.{{bc}} ðŸ«¤\n\nConfira nossos horÃ¡rios de atendimento a seguir ðŸ‘‡\n\nâ€¢ {{bo}}Segunda a sexta-feira:{{bc}} das 8h Ã s 17h.\nâ€¢ {{bo}}SÃ¡bados, domingos e feriados:{{bc}} nÃ£o hÃ¡ atendimento.\n\nAssim que o atendimento for retomado, {{bo}}vocÃª poderÃ¡ entrar em contato novamente para receber apoio no que precisar.{{bc}} ðŸ˜‰","metadata":{}},"$cardContent":{"document":{"id":"46c9433e-2a34-40de-86bd-43ae077a04f5","type":"text/plain","content":"Nosso time {{bo}}nÃ£o estÃ¡ em horÃ¡rio de atendimento.{{bc}} ðŸ«¤\n\nConfira nossos horÃ¡rios de atendimento a seguir ðŸ‘‡\n\nâ€¢ {{bo}}Segunda a sexta-feira:{{bc}} das 8h Ã s 17h.\nâ€¢ {{bo}}SÃ¡bados, domingos e feriados:{{bc}} nÃ£o hÃ¡ atendimento.\n\nAssim que o atendimento for retomado, {{bo}}vocÃª poderÃ¡ entrar em contato novamente para receber apoio no que precisar.{{bc}} ðŸ˜‰"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f7cb6fe5-7b54-462e-a389-58e19825ecc3","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6a45cd55-f67a-486d-9d4b-89d30ddcb582","$typeOfContent":"","type":"TrackEvent","$title":"transbordo fora horario exibicao","$invalid":false,"settings":{"extras":{"Headline AnÃºncio":"{{metadata@headline}}","Id do AnÃºncio":"{{metadata@source_id}}","Url do AnÃºncio":"{{metadata@source_url}}"},"category":"transbordo fora horario exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3231718f-6e81-4072-bce5-2bbf845e15ff","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-9a2ad7c1-b0e8-4117-a5a5-b3f0eb8abd4e","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-cddad251-e0fd-4ee8-9e12-7bd0b99346ef","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"b9e2adcf-0043-4925-9e29-bcb9ee9203ad","root":false,"$title":"[T.0.0.3] [Msg]","$position":{"top":"606px","left":"433px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"eb081940-795e-4c0b-b9c6-fe3e54c627df":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4c17bcb0-97aa-48c0-82c0-b9f84a10f6c8","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"9fb18cee-44ea-40d2-b0b3-e31fef731c41","typeOfStateId":"state","$connId":"con_48","$id":"383e6d1f-4d15-4e3e-8c5a-836805cc84e4","conditions":[{"source":"context","comparison":"notEquals","values":["true"],"variable":"agentControl@isOnline"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"23166695-95e8-41e1-b4ec-eb0532a391ae","typeOfStateId":"state","$connId":"con_53","$id":"f7ccf65e-7d7d-403f-b566-dfe487ed2116","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"atendimentRules@isWorkTime"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"7a65436c-a507-4c12-b085-00280b441309","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"bodyRequest\"","$invalid":false,"settings":{"function":"run","source":"function run(uuid) {\n\tconst bodyRequest = {\n\t\t\"id\": uuid,\n\t\t\"to\": \"postmaster@desk.msging.net\",\n\t\t\"method\": \"get\",\n\t\t\"uri\": \"/teams/agents-online\"\n\t}\n\n\treturn JSON.stringify(bodyRequest)\n}","inputVariables":["random.guid"],"outputVariable":"bodyRequest","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"72c3218b-5f0b-4fd1-b64c-f18d1eb66644","$typeOfContent":"","type":"ProcessHttp","$title":"[POST] Verify online agents in queue","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"{{resource.BotConfiguration@service.http}}"},"method":"POST","body":"{{bodyRequest}}","uri":"{{resource.BotConfiguration@connectionUrl}}","responseStatusVariable":"statusCode","responseBodyVariable":"response"},"conditions":[]},{"type":"ExecuteScript","$title":"Run script \"agentControl\"","$invalid":false,"settings":{"function":"run","source":"function run(response, statusCode) {\n    const agentControl = {\n        \"isOnline\": false\n    }\n\n    if (!statusCode || Number.parseInt(statusCode) !== 200) {\n        return JSON.stringify(agentControl)\n    }\n\n    try {\n        // { resource: { items: [] } }\n        const { resource } = JSON.parse(response)\n\n        const { items } = resource\n\n        const getOnlineAgentInQueue = items.find(\n            ({ agentsOnline }) => agentsOnline >= 1\n        )\n\n        agentControl[\"isOnline\"] = typeof(getOnlineAgentInQueue) !== \"undefined\" ? true : false\n\n        return JSON.stringify(agentControl)\n    } catch (error) {\n        return JSON.stringify(agentControl)\n    }\n}","inputVariables":["response","statusCode"],"outputVariable":"agentControl","LocalTimeZoneEnabled":false},"conditions":[],"$id":"4a07b116-2777-4d1a-a0d1-7e313ddf6763"}],"$leavingCustomActions":[{"$id":"fb30f74a-2f1a-4035-b40a-29da9b935766","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"atendantsStatusTracking\"","$invalid":false,"settings":{"function":"run","source":"/**\n* All input variables needs to be passed as function param;\n* Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n* Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n**/\nfunction run(agentControl) {\n\treturn agentControl ? 'Sim' : 'NÃ£o'\n}","inputVariables":["agentControl"],"outputVariable":"atendantsStatusTracking"},"conditions":[]},{"$id":"30006ba0-fae5-402a-a825-c18bbe1d20eb","$typeOfContent":"","type":"TrackEvent","$title":"relatÃ³rio disponibilidade de atendimento","$invalid":false,"settings":{"extras":{"Headline AnÃºncio":"{{metadata@headline}}","Id do AnÃºncio":"{{metadata@source_id}}","Url do AnÃºncio":"{{metadata@source_url}}"},"category":"relatÃ³rio disponibilidade de atendimento","action":"{{atendantsStatusTracking}} | {{calendar.date}} | {{calendar.hour}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"23166695-95e8-41e1-b4ec-eb0532a391ae","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-7f1d4811-a41a-410e-9911-b05a97f3c62d","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-e332fbe7-d951-4fab-a46f-394fed20b123","label":"ProcessHttp","background":"#7762E3","canChangeBackground":false},{"id":"blip-tag-b0b636b0-4fbd-477f-8063-ecadb3e14aee","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-eb3b0d18-bea4-4e92-b104-9700e05b678b","label":"TrackEvent","background":"#61D36F","canChangeBackground":false}],"id":"eb081940-795e-4c0b-b9c6-fe3e54c627df","root":false,"$title":"[Logic only] Verify agent status","$position":{"top":"595px","left":"630px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8e7b11ff-ac5b-40ec-b11e-ab78aaa83c74":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4c17bcb0-97aa-48c0-82c0-b9f84a10f6c8","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"67c35a9d-4606-4e13-a165-fc9032a74229","typeOfStateId":"state","$connId":"con_58","$id":"bc804507-b824-4bf7-bb15-e6f1dbc56aa8","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"atendimentRules@isHoliday"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"6d57be38-ae9c-47bb-bf63-d42db2560ea6","typeOfStateId":"state","$connId":"con_63","$id":"a2fd7d1c-82c9-4982-8770-ea8c106d2d26","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"atendimentRules@isWeekend"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"b9e2adcf-0043-4925-9e29-bcb9ee9203ad","typeOfStateId":"state","$connId":"con_68","$id":"383e6d1f-4d15-4e3e-8c5a-836805cc84e4","conditions":[{"source":"context","comparison":"notEquals","values":["true"],"variable":"atendimentRules@isWorkTime"}],"$isBuilderDefaultOutput":true,"$invalid":false},{"stateId":"eb081940-795e-4c0b-b9c6-fe3e54c627df","typeOfStateId":"state","$connId":"con_73","$id":"f7ccf65e-7d7d-403f-b566-dfe487ed2116","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"atendimentRules@isWorkTime"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"75ffffff-4a96-4344-9a45-db00f8c73bf1","$typeOfContent":"","type":"ExecuteScriptV2","$title":"Run script \"atendimentRules\"","$invalid":false,"settings":{"function":"run","source":"function run(ServiceScheduleRules) {\n    try {\n        const scheduleRulesResource = JSON.parse(ServiceScheduleRules);\n\n        const atendimentRules = {\n            \"isHoliday\": false,\n            \"isWeekend\": false,\n            \"isWorkTime\": false\n        };\n\n        const rulesByQueue = scheduleRulesResource[\"Default\"];\n\n        if (!rulesByQueue) {\n            return JSON.stringify(atendimentRules);\n        }\n\n        const todayIsHoliday = verifyHoliday(rulesByQueue);\n        if (todayIsHoliday) {\n            atendimentRules[\"isHoliday\"] = true;\n            return JSON.stringify(atendimentRules);\n        }\n\n        const todayIsWeekend = verifyWeekend(rulesByQueue);\n        if (todayIsWeekend) {\n            atendimentRules[\"isWeekend\"] = true;\n            return JSON.stringify(atendimentRules);\n        }\n\n        const isWorkTime = verifyWorkTime(rulesByQueue); \n        if (isWorkTime) {\n            atendimentRules[\"isWorkTime\"] = true;\n            return JSON.stringify(atendimentRules);\n        }\n\n        return JSON.stringify(atendimentRules);\n    } catch (e) {\n        return JSON.stringify({ \"isHoliday\": false, \"isWeekend\": false, \"isWorkTime\": false, \"error\": e.message });\n    }\n}\n\nfunction generateDateDetails() {\n    const offset = -3; \n    const now = new Date();\n    const today = new Date(now.getTime() + (offset * 3600000) + (now.getTimezoneOffset() * 60000));\n\n    // Capturando dia da semana\n    const weekDay = today.getDay();\n\n    // Capturando dia do mÃªs\n    const monthDay = today.getDate().toString().padStart(2, \"0\");\n\t\n    const month = (today.getMonth() + 1).toString().padStart(2, \"0\");\n\n    // Formatando data atual\n    const currentDate = `${monthDay}/${month}`;\n\n    // Capturando hora atual\n    const hours = today.getHours().toString().padStart(2, \"0\");\n    // Capturando minuto atual\n    const minutes = today.getMinutes().toString().padStart(2, \"0\");\n\n    // Formatando hora atual\n    const currentTime = `${hours}:${minutes}`;\n\n    return {\n        weekDay,\n        currentDate,\n        currentTime\n    }\n}\n\nfunction verifyHoliday(rulesByQueue) {\n\tconst holidays = rulesByQueue.holidays\n\t// dd/mm\n\tconst currentDate = generateDateDetails().currentDate\n\n\tconst todayIsHoliday = holidays.find((holiday) => holiday === currentDate)\n\n\treturn typeof(todayIsHoliday) !== \"undefined\" ? true : false\n}\n\nfunction verifyWeekend(rulesByQueue) {\n\tconst dateDetails = generateDateDetails()\n\n\tconst weekDay = dateDetails.weekDay\n\n\tif (weekDay === 0 || weekDay === 6) {\n\t\treturn !verifyServiceOnTheWeekend(rulesByQueue, weekDay)\n\t}\n\n\treturn false\n}\n\nfunction verifyServiceOnTheWeekend(rulesByQueue, weekDay) {\n\tconst haveServiceOnTheWeekend = rulesByQueue.workDays.find((dayPayload) => dayPayload.id === weekDay.toString())\n\n\treturn typeof(haveServiceOnTheWeekend) !== \"undefined\" ? true : false\n}\n\nfunction verifyWorkTime(rulesByQueue) {\n\tconst workDays = rulesByQueue.workDays\n\n\tconst dateDetails = generateDateDetails()\n\n\tconst weekDay = dateDetails.weekDay\n\tconst currentTime = dateDetails.currentTime\n\n\tconst timeToCompare = parsedTime(currentTime)\n\n\tconst currentDay = workDays.find((workDay) => workDay.id === weekDay.toString())\n\n\tif (typeof(currentDay) === \"undefined\") return false\n\n\tif (!currentDay.active) return false\n\t\n\tif (timeToCompare >= parsedTime(currentDay.start) && timeToCompare < parsedTime(currentDay.end)) {\n\t\treturn true\n\t}\n\n\treturn false\n}\n\nfunction parsedTime(time) {\n\t// time => 15:07 .split(\":\").join(\"\") => 1507\n\treturn Number.parseInt(time.split(\":\").join(\"\"))\n}","inputVariables":["resource.ServiceScheduleRules"],"outputVariable":"atendimentRules"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"eb081940-795e-4c0b-b9c6-fe3e54c627df","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-3c922796-fefa-4d48-a850-51e997e74dbc","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false}],"id":"8e7b11ff-ac5b-40ec-b11e-ab78aaa83c74","root":false,"$title":"[Logic only] Verify service schedule rules","$position":{"top":"435px","left":"629px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"67c35a9d-4606-4e13-a165-fc9032a74229":{"$contentActions":[{"action":{"$id":"15e65524-07cc-4415-8be5-b1aab953eab3","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"1f9fd1b7-2132-4eb3-9b57-a9c53140a987","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"1f9fd1b7-2132-4eb3-9b57-a9c53140a987","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a5b5569e-a8f6-4cf9-9a36-bdc517178c85","$typeOfContent":"text","type":"SendMessage","settings":{"id":"46c9433e-2a34-40de-86bd-43ae077a04f5","type":"text/plain","content":"No momento, {{bo}}nosso time atende aos feriados.{{bc}} ðŸ«¤\n\nConfira nossos horÃ¡rios de atendimento a seguir ðŸ‘‡\n\nâ€¢ {{bo}}Segunda a sexta-feira:{{bc}} das 8h Ã s 17h.\nâ€¢ {{bo}}SÃ¡bados, domingos e feriados:{{bc}} nÃ£o hÃ¡ atendimento.\n\nAssim que o atendimento for retomado, {{bo}}vocÃª poderÃ¡ entrar em contato novamente para receber apoio no que precisar.{{bc}} ðŸ˜‰","metadata":{}},"$cardContent":{"document":{"id":"46c9433e-2a34-40de-86bd-43ae077a04f5","type":"text/plain","content":"No momento, {{bo}}nosso time atende aos feriados.{{bc}} ðŸ«¤\n\nConfira nossos horÃ¡rios de atendimento a seguir ðŸ‘‡\n\nâ€¢ {{bo}}Segunda a sexta-feira:{{bc}} das 8h Ã s 17h.\nâ€¢ {{bo}}SÃ¡bados, domingos e feriados:{{bc}} nÃ£o hÃ¡ atendimento.\n\nAssim que o atendimento for retomado, {{bo}}vocÃª poderÃ¡ entrar em contato novamente para receber apoio no que precisar.{{bc}} ðŸ˜‰"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"f7cb6fe5-7b54-462e-a389-58e19825ecc3","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6a45cd55-f67a-486d-9d4b-89d30ddcb582","$typeOfContent":"","type":"TrackEvent","$title":"transbordo feriado exibicao","$invalid":false,"settings":{"extras":{"Headline AnÃºncio":"{{metadata@headline}}","Id do AnÃºncio":"{{metadata@source_id}}","Url do AnÃºncio":"{{metadata@source_url}}"},"category":"transbordo feriado exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3231718f-6e81-4072-bce5-2bbf845e15ff","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-e2b8d9b7-dd03-4f4d-8ab2-656a28f74a22","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-9cce90dd-7589-4471-9511-9fe3958275c2","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"67c35a9d-4606-4e13-a165-fc9032a74229","root":false,"$title":"[T.0.0.1] [Msg]","$position":{"top":"458px","left":"420px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e651c432-0dd7-47fe-a318-4ad0d99459c5":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bb13eff6-e919-49ac-ad31-ed32355de66a","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const message = {\n        service: \"pesquisa\",\n        destinyBlock: \"default\",\n    };\n\n    return message;\n}","inputVariables":[],"outputVariable":"redirectMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"318e0660-a592-4ef4-b965-21e7898683c7","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"pesquisa\"","$invalid":false,"settings":{"address":"{{redirectMessage@service}}","context":{"type":"text/plain","value":"{{redirectMessage}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-dfaa3e4c-0163-4c70-86a6-f95ea6623059","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-89a86edf-36b3-40f4-81f5-a4ada30db785","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"e651c432-0dd7-47fe-a318-4ad0d99459c5","root":false,"$title":"[Redirect to] Pesquisa","$position":{"top":"545px","left":"132px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"9fb18cee-44ea-40d2-b0b3-e31fef731c41":{"$contentActions":[{"action":{"$id":"fa147b0b-3e41-4009-8671-7454c89718c4","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"b44e39a0-e536-43bd-bf44-bda2213eddc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"b44e39a0-e536-43bd-bf44-bda2213eddc5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f0c513bd-282a-4f4a-87e8-06efd4c7f3d0","$typeOfContent":"raw-content","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendRawMessage","settings":{"metadata":{},"type":"{{menuPayload@type}}","rawContent":"{{menuPayload@content}}"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1f655887-ce58-475f-9c95-886d737bf047","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"2ef282c5-18ce-4b65-bbde-4a1f66edb2e6","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"menuPayload\"","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(boldTags, platform) {\n    let platformInLowerCase = platform.toLowerCase()\n    \n    if (platformInLowerCase == 'instagram' || platformInLowerCase == 'telegram' || platformInLowerCase == 'messenger') {\n        platformInLowerCase = 'blipchat'\n    }\n\n    /*\n    ** Tornando o JSON \"boldTags\" acessÃ­vel para ser enviado como parÃ¢metro \n    ** na constante \"dynamicMenuBuildingDetails\"\n    */\n    boldTags = JSON.parse(boldTags)\n\n    const { open, close } = boldTags\n\n    const dynamicMenuBuildingDetails = {\n        \"text\": `Parece que nossos atendentes estÃ£o ocupados no momento.ðŸ˜…\\n\\n${open}Mas jÃ¡ te coloquei na fila de atendimento!${close}\\n\\nAssim que liberarem, alguÃ©m do time vai falar com vocÃª para te ajudar com tudo que precisar. ðŸ˜Š`,\n        \"header\": '',\n        \"body\": `Parece que nossos atendentes estÃ£o ocupados no momento.ðŸ˜…\\n\\n${open}Mas jÃ¡ te coloquei na fila de atendimento!${close}\\n\\nAssim que liberarem, alguÃ©m do time vai falar com vocÃª para te ajudar com tudo que precisar. ðŸ˜Š`,\n        \"footer\": 'Aperte o botÃ£o a seguir caso queira sair da fila.',\n        \"button\": 'Abrir menu',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        \"options\": ['Sair da fila'],\n        \"values\": ['Sair da fila'],\n        \"description\": [],\n        \"menuScope\": {\n            \"whatsappButton\": true,\n            \"whatsappList\": false,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": true,\n            \"blipchatMenu\": false,\n            \"defaultText\": false,\n            \"platform\": platformInLowerCase,\n            \"boldValue\": boldTags,\n        },\n    }\n\n    const dinamycMenuSchema = getMenuForPlatform(dynamicMenuBuildingDetails)\n\n    return dinamycMenuSchema\n}","inputVariables":["boldTags","platform"],"outputVariable":"menuPayload"},"conditions":[]},{"$id":"e07da8ab-3ef7-4976-be45-8d227ad4ed93","$typeOfContent":"","type":"SetVariable","$title":"Merge variable \"errorType\"","$invalid":false,"settings":{"variable":"errorType","value":"menu botao"},"conditions":[]},{"$id":"b4476379-2d84-4086-8bc0-fc44807f06da","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"returnBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(prevId, stateId) {\n\tconst returnBlock = {\n        \"default\": stateId,\n        \"blocoAnterior\": prevId\n    }\n\n    return JSON.stringify(returnBlock)\n}","inputVariables":["state.previous.id","state.id"],"outputVariable":"returnBlock"},"conditions":[]},{"$id":"7fc2e355-7896-4960-9e85-b4efff6c7c5c","$typeOfContent":"","type":"TrackEvent","$title":"transbordo atendente ocupado exibicao","$invalid":false,"settings":{"extras":{"Headline AnÃºncio":"{{metadata@headline}}","Id do AnÃºncio":"{{metadata@source_id}}","Url do AnÃºncio":"{{metadata@source_url}}"},"category":"transbordo atendente ocupado exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"7a5f6eeb-1034-4aa5-b97f-ffefee8eba2b","$typeOfContent":"","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"ExecuteScriptV2","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade')\n        \n        if (userContentType !== 'text/plain') {\n            userContent = JSON.parse(userContent)\n            \n            userContent = userContent['uri']\n            \n            throw new Error('input inesperado')\n        }\n\n        const menuOptions = {\n            \"1\": \"Sair da fila\",\n        }\n\n        const menuRegex = {\n            \"1\": \"^Sair da fila$\"\n        }\n\n        for (const prop in menuRegex) {\n            const regexOption = new RegExp(menuRegex[prop], \"igm\")\n\n            if (regexOption.test(userContent)) {\n\n                return JSON.stringify({\n                    success: true,\n                    data: menuOptions[prop],\n                    input: userContent,\n                    message: 'vÃ¡lido'\n                }, null, 2)\n            }\n        }\n\n        throw new Error('input inesperado')\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || error.message,\n            message: 'invÃ¡lido'\n        }, null, 2)\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:6db00a2d-e3d3-4809-93b2-cb2500a06fa6","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-66571015-b665-4431-b27e-5567e05cba50","label":"ExecuteScriptV2","background":"#FFB74D","canChangeBackground":false},{"id":"blip-tag-03fcccec-6fef-4d68-8073-1ae09aa3ee98","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-a7a3a748-f050-486e-bb5c-cd928120711a","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-12625bfc-d71c-4383-af1f-f98e44a48f84","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"9fb18cee-44ea-40d2-b0b3-e31fef731c41","root":false,"$title":"[T.0.0.2] [Menu] [Input] [Val]","$position":{"top":"594px","left":"831px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3231718f-6e81-4072-bce5-2bbf845e15ff":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"bb13eff6-e919-49ac-ad31-ed32355de66a","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run() {\n    const message = {\n        service: \"algoMais\",\n        destinyBlock: \"default\",\n    };\n\n    return message;\n}","inputVariables":[],"outputVariable":"redirectMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"318e0660-a592-4ef4-b965-21e7898683c7","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"Pesquisa\"","$invalid":false,"settings":{"address":"{{redirectMessage@service}}","context":{"type":"text/plain","value":"{{redirectMessage}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-d624b27b-5fbe-4952-8cc0-6a4b40da39a8","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-9bb3b097-fb13-43dd-a85f-4100e1a792c8","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"3231718f-6e81-4072-bce5-2bbf845e15ff","root":false,"$title":"[Redirect to] Algo mais","$position":{"top":"686px","left":"132px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"6d57be38-ae9c-47bb-bf63-d42db2560ea6":{"$contentActions":[{"action":{"$id":"e4c8eac7-7d18-46d1-98c9-a56aa3ff7114","$typeOfContent":"chat-state","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"14330dc6-629d-4176-8509-501c5fbe46f5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"14330dc6-629d-4176-8509-501c5fbe46f5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"0057ac6b-fcde-4dd0-8d6c-39d394ed183b","$typeOfContent":"text","$description":"","$inputSchema":{"type":"object","properties":{},"required":[]},"type":"SendMessage","settings":{"id":"5257ce92-b095-489b-8bc4-3b9a50a4bf26","type":"text/plain","content":"No momento, {{bo}}nosso time atende aos fins de semana.{{bc}} ðŸ«¤\n\nConfira nossos horÃ¡rios de atendimento a seguir ðŸ‘‡\n\nâ€¢ {{bo}}Segunda a sexta-feira:{{bc}} das 8h Ã s 17h.\nâ€¢ {{bo}}SÃ¡bados, domingos e feriados:{{bc}} nÃ£o hÃ¡ atendimento.\n\nAssim que o atendimento for retomado, {{bo}}vocÃª poderÃ¡ entrar em contato novamente para receber apoio no que precisar.{{bc}} ðŸ˜‰","metadata":{}},"$cardContent":{"document":{"id":"5257ce92-b095-489b-8bc4-3b9a50a4bf26","type":"text/plain","content":"No momento, {{bo}}nosso time atende aos fins de semana.{{bc}} ðŸ«¤\n\nConfira nossos horÃ¡rios de atendimento a seguir ðŸ‘‡\n\nâ€¢ {{bo}}Segunda a sexta-feira:{{bc}} das 8h Ã s 17h.\nâ€¢ {{bo}}SÃ¡bados, domingos e feriados:{{bc}} nÃ£o hÃ¡ atendimento.\n\nAssim que o atendimento for retomado, {{bo}}vocÃª poderÃ¡ entrar em contato novamente para receber apoio no que precisar.{{bc}} ðŸ˜‰"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0ead7d39-bba0-4507-ba74-fa2fd36af048","type":"text/plain","textContent":"Entrada do usuÃ¡rio","content":"Entrada do usuÃ¡rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6993ec02-6c1b-4c53-ab8d-ca2635367f03","$typeOfContent":"","type":"TrackEvent","$title":"transbordo fim de semana exibicao","$invalid":false,"settings":{"extras":{"Headline AnÃºncio":"{{metadata@headline}}","Id do AnÃºncio":"{{metadata@source_id}}","Url do AnÃºncio":"{{metadata@source_url}}"},"category":"transbordo fim de semana exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"3231718f-6e81-4072-bce5-2bbf845e15ff","$invalid":false,"typeOfStateId":"state"},"$localCustomActions":[],"isAiGenerated":false,"$tags":[{"id":"blip-tag-51aa63d9-3873-4221-b2db-044787d8f3f8","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-a57980f7-2e8c-46ad-b600-4344d9a38937","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"6d57be38-ae9c-47bb-bf63-d42db2560ea6","root":false,"$title":"[T.0.0.2] [Msg]","$position":{"top":"459px","left":"821px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$localCustomActions":[],"isAiGenerated":false,"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}