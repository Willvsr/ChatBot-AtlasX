{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"f165096a-7776-4c4f-911a-70dca94c2115","type":"text/plain","content":"Entrada do usu치rio"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"19680bbf-7c06-41c5-82db-bf3e6f4d3438","typeOfStateId":"state","$connId":"con_3","$id":"d4db55f0-4ed7-4705-a3c7-8bcbdc8d2e0f","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"inatividade"}],"$invalid":false},{"stateId":"148c62f3-3e2a-41bb-acd8-4fcf1ee746d3","typeOfStateId":"state","$connId":"con_8","$id":"3a0b810a-4d62-4162-9f30-74684cc8d5eb","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"020b724c-0a6e-4495-b8a3-1ffd8c43224b","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"flow\"","$invalid":false,"settings":{"function":"run","source":"function run(redirectMessage) {\n    const { flow } = JSON.parse(redirectMessage);\n\n    return flow;\n}","inputVariables":["input.content"],"outputVariable":"flow","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"85464500-eb9e-4c14-a235-524217df8f6a","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"userInput\"","$invalid":false,"settings":{"function":"run","source":"function run(redirectMessage) {\n    const { input } = JSON.parse(redirectMessage);\n\n    return input;\n}","inputVariables":["input.content"],"outputVariable":"userInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"170c936a-0b9c-455a-9547-5fcfd0f22ace","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"returnService\"","$invalid":false,"settings":{"function":"run","source":"function run(redirectMessage) {\n    const { origin } = JSON.parse(redirectMessage);\n\n    if (origin.includes(\"boasvindas\")) return \"boasVindas\";\n\n    if (origin.includes(\"finalizacao\")) return \"finalizacao\";\n\n    if (origin.includes(\"cadastro\")) return \"cadastro\";\n\n    if (origin.includes(\"transbordo\")) return \"transbordo\";\n    \n    if (origin.includes(\"principal\")) return \"principal\";\n    \n    if (origin.includes(\"identificacaoevalidacao\")) return \"identificacaoValidacao\";\n    \n    if (origin.includes(\"algomais\")) return \"algoMais\";\n    \n    if (origin.includes(\"pesquisa\")) return \"pesquisa\";\n};","inputVariables":["flow"],"outputVariable":"returnService","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"49a12bad-eb05-4ef9-ac87-b7a0746a4664","$typeOfContent":"","type":"SetVariable","$title":"Set \"0\" to variable \"countError\"","$invalid":false,"settings":{"variable":"countError","value":"0"},"conditions":[{"source":"context","comparison":"notExists","values":[],"variable":"countError"}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"148c62f3-3e2a-41bb-acd8-4fcf1ee746d3","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-2d33e03b-653e-4384-849e-a16d40ac7653","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-97e734eb-c4e7-46bd-93b2-0d9ccca8c8d1","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-fd88822f-96bd-4db4-a366-c24bebeabdd6","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"onboarding","root":true,"$title":"In칤cio","$position":{"top":"352px","left":"633px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"a83c8c7c-831e-408e-9f66-6ff1ab8be7ec","type":"text/plain","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"467839d0-6491-4f81-9f7f-f6f560036556","typeOfStateId":"state","$connId":"con_13","$id":"5da5bb80-7aa6-4d99-8cca-1545b48d26ad","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"errorPersistant"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"467839d0-6491-4f81-9f7f-f6f560036556","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"fallback","$title":"Exce칞칫es","$position":{"top":"350.667px","left":"2736px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"16294600-3e00-450c-bd03-8ca62d83158d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"4cf96108-685a-4c98-9970-4ca3851d07cb","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"2a9a8d0b-835a-431c-928b-37d93f389f56","typeOfStateId":"state","$connId":"con_18","$id":"e7437c7b-316f-4ea5-986c-10a3a6aad080","conditions":[{"source":"context","comparison":"equals","values":["text"],"variable":"errorMessage"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"ac27fd0c-d9e5-4ad1-8cbe-3ead222b47fe","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"errorMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput, boldTags) {\n    const bold = JSON.parse(boldTags)\n\n    userInput = JSON.parse(userInput)\n\n    let contentType = userInput.type\n\n    if (contentType === \"application/vnd.lime.media-link+json\") {\n        contentType = JSON.parse(userInput.input)[\"type\"]\n    }\n\n    if (contentType.includes(\"image\")) {\n        return `Infelizmente, ainda n칚o consigo processar imagens... 游땞\\n\\n${bold.open}Mas podemos conversar por texto!${bold.close} 游때`\n    } \n\n    if (contentType.includes(\"audio\")) {\n        return `Infelizmente, ainda n칚o consigo entender 치udios... 游땞\\n\\n${bold.open}Mas podemos conversar por texto!${bold.close} 游때`\n    }\n\n    if (contentType.includes(\"video\")) {\n        return `Infelizmente, ainda n칚o consigo assistir a v칤deos... 游땞\\n\\n${bold.open}Mas podemos conversar por texto!${bold.close} 游때`\n    }\n\n    if (contentType.includes(\"pdf\")) {\n        return `Ainda ${bold.open}n칚o entendo este tipo de conte칰do.${bold.close} Por enquanto s칩 consigo ler mensagens de texto.`\n    }\n    \n    return \"text\"\n}","inputVariables":["userInput","boldTags"],"outputVariable":"errorMessage","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e5336925-ba9c-4be1-bd94-67cba44dcfc4","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"errorType\"","$invalid":false,"settings":{"function":"run","source":"function run(errorMessage) {\n\t if (errorMessage.includes(\"images\")) return \"imagem\";\n\n    if (errorMessage.includes(\"치udio\")) return \"audio\";\n\n    if (errorMessage.includes(\"v칤deo\")) return \"video\";\n\n    if (errorMessage.includes(\"documento\")) return \"documento\";\n}","inputVariables":["errorMessage"],"outputVariable":"errorType","LocalTimeZoneEnabled":false},"conditions":[{"values":["text"],"source":"context","variable":"errorMessage","comparison":"notEquals"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"c4fcab1b-98b6-412c-8047-385504d233f4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-6e093561-592c-48af-9ca9-8a88ca3c65c9","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"16294600-3e00-450c-bd03-8ca62d83158d","root":false,"$title":"[CV.1.1.0][Logic Only] Verify unsupported content","$position":{"top":"739px","left":"637px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"c4fcab1b-98b6-412c-8047-385504d233f4":{"$contentActions":[{"action":{"$id":"a5ffa4b6-1866-44b7-8b45-dd8deeb057b5","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"7c58639f-e03b-4259-9485-593c1b3bd787","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"7c58639f-e03b-4259-9485-593c1b3bd787","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"50574cca-c38d-41b6-b718-099c51d5401f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e9ed6144-301c-41ee-87b3-1dd0ed4f937f","type":"text/plain","content":"{{errorMessage}}","metadata":{}},"$cardContent":{"document":{"id":"e9ed6144-301c-41ee-87b3-1dd0ed4f937f","type":"text/plain","content":"{{errorMessage}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"0db46307-d52c-4717-a598-4792c87f5a88","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a781691e-4f91-49dd-85a7-280f3fe5e5a9","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"dinamycErrorTracking\"","$invalid":false,"settings":{"function":"run","source":"function run(errorType) {\n\tconst dinamycErrorTracking = {\n\t\texibition: `Erro ${errorType} exibicao`,\n\t\torigin: `Erro ${errorType} origem`,\n\t}\n\t\n\treturn JSON.stringify(dinamycErrorTracking)\n}","inputVariables":["errorType"],"outputVariable":"dinamycErrorTracking","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"2ff81ee0-bb45-4ccb-8d20-7b39ecfcceb9","$typeOfContent":"","type":"TrackEvent","$title":"Erro exibicao","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"{{dinamycErrorTracking@exibition}}","action":"Exibicao"},"conditions":[]},{"$id":"c8467487-18da-4635-b531-55c4ff728b3b","$typeOfContent":"","type":"TrackEvent","$title":"Erro origem","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"{{dinamycErrorTracking@origin}}","action":"{{returnService}} | {{flow@blockOrigin}} | {{userInput@input}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-465f2157-7ed8-456b-a27e-995e2897d269","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-87bd9296-4fdf-456a-8e24-bca37ab221b3","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-b06310ef-98ae-497e-8608-f3b334435de3","label":"SendMessage","background":"#EE82EE","canChangeBackground":false}],"id":"c4fcab1b-98b6-412c-8047-385504d233f4","root":false,"$title":"[X.0.0.X] [Msg]","$position":{"top":"1151px","left":"1175px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2a9a8d0b-835a-431c-928b-37d93f389f56":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b801e7c4-ac70-4681-8692-b978b1bffd13","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"8c6b24c4-b6d7-440a-8a1a-425e4d13071b","typeOfStateId":"state","$connId":"con_23","$id":"2e78c178-7256-4a24-b0e7-40e6e88caf80","conditions":[{"source":"context","comparison":"equals","values":["default"],"variable":"errorMessage"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"217680b5-c7d1-4bd1-86a1-c45a67119a11","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"errorMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(userInput, boldvalue) {\n    const bold = JSON.parse(boldvalue)\n\n    const { input } = JSON.parse(userInput)\n\n    const regex_emoji = /[\\u2600-\\u26ff]|[\\u2600-\\u27ff]|[\\u2700-\\u27bf]|\\u00a9|\\u00ae|[\\u2000-\\u3300]|\\ud83c[\\ud000-\\udfff]|\\ud83d[\\ud000-\\udfff]|\\ud83e[\\ud000-\\udfff]|\\ud83c[\\udf00-\\udfff]|\\ud83d[\\udc00-\\ude4f]|\\ud83d[\\ude80-\\udeff]|\\ud83c[\\udde6-\\uddff]|\\ud83c[\\udffb-\\udfff]/\n    const regex_url = /(https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?:\\/\\/(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})/gim\n\n    if (input.match(regex_emoji)) {\n        return `Tamb칠m adoro emojis, mas para a gente continuar a conversar, preciso que voc칡 envie sua mensagem em texto. 游삤`\n    }\n\n    if (input.match(regex_url)) {\n        return `Infelizmente, ainda n칚o consigo acessar links... 游땞\\n\\n${bold.open}Mas podemos conversar por texto!${bold.close} 游때`\n    }\n    \n    return \"default\"\n}","inputVariables":["userInput","boldTags"],"outputVariable":"errorMessage","LocalTimeZoneEnabled":false},"conditions":[],"continueOnError":false},{"$id":"a187e09a-2f9a-49f0-96e4-4201aa5fa966","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"errorType\"","$invalid":false,"settings":{"function":"run","source":"function run(errorMessage) {\n\t if (errorMessage.includes(\"emojis\")) return \"emoji\";\n\n    if (errorMessage.includes(\"links\")) return \"link\";\n}","inputVariables":["errorMessage"],"outputVariable":"errorType","LocalTimeZoneEnabled":false},"conditions":[{"values":["default"],"source":"context","variable":"errorMessage","comparison":"notEquals"}]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"c4fcab1b-98b6-412c-8047-385504d233f4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-bb7e270d-9ddb-480b-8ef4-0ca0d2105389","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"2a9a8d0b-835a-431c-928b-37d93f389f56","root":false,"$title":"[CV.1.2.0][Logic Only] Verify links and emojis","$position":{"top":"866px","left":"824px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e9b00381-86e9-4c33-8d0c-b55ab9bb128d":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"55341ad5-2c3b-4593-ad57-d685b311c3f8","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"16294600-3e00-450c-bd03-8ca62d83158d","typeOfStateId":"state","$connId":"con_28","$id":"f6e73a75-dcae-44bf-a563-98d1746b3fb6","conditions":[{"source":"context","comparison":"lessThan","values":["3"],"variable":"countError"}],"$invalid":false},{"stateId":"f3d01d60-2371-4088-8d03-603cd8802385","typeOfStateId":"state","$connId":"con_33","$id":"5b778fd4-2ec8-4875-8a30-73417bd56907","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["3"],"variable":"countError"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"9391d25a-5df1-4570-a4fa-326fa510f8f0","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"previousErrorBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(flow) {\n    const { blockOrigin } = JSON.parse(flow);\n\n    return blockOrigin;\n}","inputVariables":["flow"],"outputVariable":"previousErrorBlock","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"82eae1e3-6963-4975-a6ea-8cabf89769cd","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"countError\"","$invalid":false,"settings":{"function":"run","source":"function run(comparatorBlock, previousErrorBlock, countError) {\n  if (comparatorBlock !== previousErrorBlock) {\n    let countError = 0\n  }\n\n  countError = parseInt(countError)\n\n  return ++countError\n}","inputVariables":["comparatorBlock","previousErrorBlock","countError"],"outputVariable":"countError","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-c65138e0-258a-438f-b4e4-7b91dcfcad39","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"e9b00381-86e9-4c33-8d0c-b55ab9bb128d","root":false,"$title":"[CV.1.0.0][Logic Only] Counter Error","$position":{"top":"608px","left":"634px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"467839d0-6491-4f81-9f7f-f6f560036556":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"b280dcc5-3eeb-4fab-9f98-d3cadc3bb07f","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"faae882b-a0e5-43c1-b03e-01af5ef92933","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-8ebb68c2-c363-1ef5-3aa1-8834c271535a","canChangeBackground":false}],"id":"467839d0-6491-4f81-9f7f-f6f560036556","root":false,"$title":"[Go to] Previous Service","$position":{"top":"448px","left":"2738px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"8c6b24c4-b6d7-440a-8a1a-425e4d13071b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"6b004e0d-6970-4dd2-b240-1aaa8c867f71","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"c4fcab1b-98b6-412c-8047-385504d233f4","typeOfStateId":"state","$connId":"con_38","$id":"60ef50d7-fa81-4614-80f3-9e0518e65871","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"871b07f2-4673-4f32-be7b-e60ea7f6af0b","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"errorMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(boldTags, italicTags, errorType) {\n    const bold = JSON.parse(boldTags);\n    const italic = JSON.parse(italicTags);\n\n    switch (errorType) {\n        case \"menu\":\n            return `Sinto muito, n칚o entendi a op칞칚o selecionada... 游땛\\n\\nVamos tentar novamente? ${bold.open}Preciso que selecione uma das op칞칫es a seguir:${bold.close}`;\n\n        case \"cpf cnpj\":\n            return `Ops! Parece que o n칰mero est치 ${bold.open}incompleto ou incorreto.${bold.close} 游븷\\n\\nPor favor, confira o documento e digite novamente.`;\n\n       case \"api\":\n        return `Sinto muito, estamos passando por uma instabilidade... \\nPor favor, ${bold.open}tente novamente em alguns instantes.${bold.close}`;\n    }\n\n    //erro generico\n    return \"Ops, n칚o entendi o que disse!\\n\\nVamos tentar de novo?\"\n}","inputVariables":["boldTags","italicTags","errorType"],"outputVariable":"errorMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"c4fcab1b-98b6-412c-8047-385504d233f4","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-3cd99098-968a-407d-9974-9faeba3271c2","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"8c6b24c4-b6d7-440a-8a1a-425e4d13071b","root":false,"$title":"[CV.1.3.0][Logic Only] Verify error type","$position":{"top":"1021px","left":"985px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"14740fef-8b87-454f-ab98-2161aa40b8b3":{"$contentActions":[{"action":{"$id":"65f5fe80-d974-4c4e-8ff8-8ff1790e5e4a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"abe4cb15-b86e-44ff-b89a-2295e8c10b25","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"abe4cb15-b86e-44ff-b89a-2295e8c10b25","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"504d800d-321c-4600-8b0f-85af2461c9bc","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menuPayload@type}}","rawContent":"{{menuPayload@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"dabbdf81-6fa7-46fa-b01a-178760d9b4df","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:15"},"$invalid":false}],"$conditionOutputs":[{"stateId":"406da672-eb0e-49d5-b76b-5da64da25fd2","typeOfStateId":"state","$connId":"con_43","$id":"961b6011-ce96-4709-b922-db9dc714223b","conditions":[{"source":"context","comparison":"equals","values":["Continuar a conversa"],"variable":"processedInput@data"}],"$invalid":false},{"stateId":"e8bdd986-93a1-4ffc-8c3c-9cf87dcf5e84","typeOfStateId":"state","$connId":"con_48","$id":"1e059f9e-2830-4382-acec-eecd2fe0c55a","conditions":[{"source":"context","comparison":"notEquals","values":["inatividade"],"variable":"processedInput@data"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"116c4d20-188a-4101-97b3-c199ae9f4824","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"menuPayload\"","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(boldTags, platform) {\n    let platformInLowerCase = platform.toLowerCase()\n\n    if (platformInLowerCase == 'instagram' || platformInLowerCase == 'telegram' || platformInLowerCase == 'messenger') {\n        platformInLowerCase = 'blipchat'\n    }\n\n    /*\n    ** Tornando o JSON \"boldTags\" acess칤vel para ser enviado como par칙metro \n    ** na constante \"dynamicMenuBuildingDetails\"\n    */\n    boldTags = JSON.parse(boldTags)\n\n    const { open, close } = boldTags\n\n    const dynamicMenuBuildingDetails = {\n        \"text\": `Oi! Ainda est치 por a칤? 游뱂\\n\\nVi que faz um tempinho que n칚o falamos. ${open}Quer continuar com a conversa?${close}`,\n        \"header\": '',\n        \"body\": `Oi! Ainda est치 por a칤? 游뱂\\n\\nVi que faz um tempinho que n칚o falamos. ${open}Quer continuar com a conversa?${close}`,\n        \"footer\": '',\n        \"button\": '',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        \"options\": ['Continuar a conversa', 'Finalizar conversa'],\n        \"values\": ['Continuar a conversa', 'Finalizar conversa'],\n        \"description\": [],\n        \"menuScope\": {\n            \"whatsappButton\": true,\n            \"whatsappList\": false,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": true,\n            \"blipchatMenu\": false,\n            \"defaultText\": false,\n            \"platform\": platformInLowerCase,\n            \"boldValue\": boldTags,\n        },\n    }\n\n    const dinamycMenuSchema = getMenuForPlatform(dynamicMenuBuildingDetails)\n\n    return dinamycMenuSchema\n}","inputVariables":["boldTags","platform"],"outputVariable":"menuPayload","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"e6a26d1b-a41a-490b-9885-5aa113432cc4","$typeOfContent":"","type":"SetVariable","$title":"Set \"false\" to variable \"inatividade\"","$invalid":false,"settings":{"variable":"inatividade","value":"false"},"conditions":[]},{"$id":"c8ec0b48-b056-450c-b579-5a3ddc0a3bd6","$typeOfContent":"","type":"SetVariable","$title":"Set \"0\" to variable \"countError\"","$invalid":false,"settings":{"variable":"countError","value":"0"},"conditions":[]},{"$id":"625dff4d-bd43-4ecc-a329-29cded6cdf9d","$typeOfContent":"","type":"TrackEvent","$title":"inatividade origem","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"inatividade origem","action":"{{returnService}} | {{flow@blockOrigin}}"},"conditions":[]},{"$id":"3d724984-adbf-4ae0-8783-e127dad5299a","$typeOfContent":"","type":"TrackEvent","$title":"inatividade exibicao","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"inatividade exibicao","action":"Exibicao"},"conditions":[]}],"$leavingCustomActions":[{"$id":"86058ba7-53e3-4bd4-b88b-3b072386452b","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade')\n\n        if (userContentType !== \"text/plain\") throw new Error('input inesperado')\n\n        const menuOptions = {\n            \"1\": \"Continuar a conversa\",\n            \"2\": \"Finalizar conversa\",\n        }\n\n        const menuRegex = {\n            \"1\": \"^1$|^um$|^primeiro$|Continuar a conversa|continuar\",\n            \"2\": \"^2$|^dois$|^segundo$|Finalizar conversa|finalizar|sair|encerrar\",\n        }\n\n        for (const prop in menuRegex) {\n            const regexOption = new RegExp(menuRegex[prop], \"igm\")\n\n            if (regexOption.test(userContent)) {\n                return JSON.stringify({\n                    success: true,\n                    data: menuOptions[prop],\n                    input: userContent,\n                    message: 'v치lido'\n                }, null, 2)\n            }\n        }\n\n        throw new Error('input inesperado')\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || error.message,\n            message: 'inv치lido'\n        }, null, 2)\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d79e60be-3db1-424b-a6ed-a41b3423a930","$typeOfContent":"","type":"TrackEvent","$title":"inatividade selecao","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"Inatividade selecao","action":"{{processedInput@data}}"},"conditions":[]},{"$id":"051ea8dd-6165-49e3-8b74-8581babb42db","$typeOfContent":"","type":"TrackEvent","$title":"inatividade inesperado","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"inatividade inesperado","action":"{{processedInput@input}}"},"conditions":[{"source":"context","comparison":"equals","variable":"processedInput@data","values":["input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5511d309-7014-4923-9190-b3e70731d55b","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-666d47c8-e3a8-4e60-a11b-03475e0dd639","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-19c1ceb3-9686-444c-875a-d3289599df11","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false},{"id":"blip-tag-60138f2c-6144-4586-b6ee-9bf9ca5fbc08","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-c1dc79e1-3812-4427-9097-590d4fffe3ae","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-32fad77f-dac1-4e6b-bac6-d1ea952d0d12","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"14740fef-8b87-454f-ab98-2161aa40b8b3","root":false,"$title":"[I.0.0.0] [Menu] [Input] [Val]","$position":{"top":"359px","left":"1726px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"invalidOutputs":true},"148c62f3-3e2a-41bb-acd8-4fcf1ee746d3":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"387f5e1e-c82f-4b91-9d86-ca321373ea77","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"e9b00381-86e9-4c33-8d0c-b55ab9bb128d","typeOfStateId":"state","$connId":"con_53","$id":"4bd64ac8-2fbc-473a-a089-14c377d8dee5","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4fd3b2b4-3d65-4024-9b3e-c521391e9f09","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"comparatorBlock\"","$invalid":false,"settings":{"function":"run","source":"function run(previousErrorBlock) {\n    if (!previousErrorBlock) return \"default\"\n\n    return previousErrorBlock\n}","inputVariables":["previousErrorBlock"],"outputVariable":"comparatorBlock","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"id":"blip-tag-3439ffc6-3a32-4572-8c99-e720a7a1424e","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false}],"id":"148c62f3-3e2a-41bb-acd8-4fcf1ee746d3","root":false,"$title":"[Logic Only] Previous Block","$position":{"top":"469px","left":"631px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"19680bbf-7c06-41c5-82db-bf3e6f4d3438":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c251871e-7c9c-4a13-a1aa-ff8005ffda52","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"14740fef-8b87-454f-ab98-2161aa40b8b3","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-8ebb68c2-c363-1ef5-3aa1-8834c271535a","canChangeBackground":false}],"id":"19680bbf-7c06-41c5-82db-bf3e6f4d3438","root":false,"$title":"[Go to] Inatividade","$position":{"top":"350px","left":"818px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"406da672-eb0e-49d5-b76b-5da64da25fd2":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"67fb8dd4-a7bf-4572-b616-231b1a990189","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"4dbe293e-8f00-458c-9526-bbc951c878da","$typeOfContent":"","type":"SetVariable","$title":"Set \"true\" to variable \"persistentReturn\"","$invalid":false,"settings":{"variable":"persistentReturn","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-8ebb68c2-c363-1ef5-3aa1-8834c271535a","canChangeBackground":false},{"id":"blip-tag-508a09a4-c47c-43ae-abeb-ed04c63f3023","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"406da672-eb0e-49d5-b76b-5da64da25fd2","root":false,"$title":"[Go to] Previous block","$position":{"top":"503px","left":"1728px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false,"addonsSettings":{"backgroundColor":"#fff9c4","textColor":"#000000"}},"9a2dc89e-e7d6-4802-8243-1e3009bbb129":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"7c2ffe51-2436-4a13-9394-936cd3b4c0ad","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(lastBlock) {\n    const message = {\n        flow: {\n            origin: \"excecoes\",\n            blockOrigin: lastBlock,\n        },\n        service: \"finalizacao\",\n        destinyBlock: \"default\",\n    };\n\n    return JSON.stringify(message)\n}","inputVariables":["lastBlock"],"outputVariable":"redirectMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d590a51c-5cdb-4d64-b0fe-165e94ee8dba","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"Finalizacao\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-a19666b8-a213-4d8e-8c5a-eb75db452840","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-8722a822-e262-4eab-bafc-99f90c4cce81","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"9a2dc89e-e7d6-4802-8243-1e3009bbb129","root":false,"$title":"[Redirect to] Finalizacao","$position":{"top":"376px","left":"232.667px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"faae882b-a0e5-43c1-b03e-01af5ef92933":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"a7471c27-2c50-483b-bba8-579d4efd5d76","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(flow, returnService) {\n    const flow = JSON.parse(flow);\n\n    const  redirectMessage = {\n        service: returnService,\n        flow,\n        destinyBlock: flow.blockOrigin,\n    }\n\n    return redirectMessage;\n}","inputVariables":["flow","returnService"],"outputVariable":"redirectMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"e67fbcd8-1438-4483-a567-467c23922cbe","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"Previous Service\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-95de64ef-a9ae-4a0f-8579-71b50c84f443","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ce44a5c7-26ca-452f-a7d9-931adbd66286","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"faae882b-a0e5-43c1-b03e-01af5ef92933","root":false,"$title":"[Redirect to] Previous Service","$position":{"top":"509px","left":"230px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8bdd986-93a1-4ffc-8c3c-9cf87dcf5e84":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a8d6edd-262f-477e-8363-2ee4263c9ada","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"56545979-88cf-4fa4-9a6c-193594effaaa","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastBlock\" to blip variable \"state.previous.name\"","$invalid":false,"settings":{"variable":"lastBlock","value":"{{state.previous.name}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9a2dc89e-e7d6-4802-8243-1e3009bbb129","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-8ebb68c2-c363-1ef5-3aa1-8834c271535a","canChangeBackground":false},{"id":"blip-tag-52facbef-c81a-4e31-85a2-96df801a9109","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"e8bdd986-93a1-4ffc-8c3c-9cf87dcf5e84","root":false,"$title":"[Go to] Finalizacao","$position":{"top":"368.667px","left":"1912.33px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","commentsIdList":[],"textColor":"#000000"},"isAiGenerated":false},"5511d309-7014-4923-9190-b3e70731d55b":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a8d6edd-262f-477e-8363-2ee4263c9ada","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"56545979-88cf-4fa4-9a6c-193594effaaa","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastBlock\" to blip variable \"state.previous.name\"","$invalid":false,"settings":{"variable":"lastBlock","value":"{{state.previous.name}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"9a2dc89e-e7d6-4802-8243-1e3009bbb129","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-8ebb68c2-c363-1ef5-3aa1-8834c271535a","canChangeBackground":false},{"id":"blip-tag-8a1b5d1f-2293-421c-bfe8-9fb333b7201c","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"5511d309-7014-4923-9190-b3e70731d55b","root":false,"$title":"[Go to] Finalizacao","$position":{"top":"758px","left":"1105px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","commentsIdList":[],"textColor":"#000000"},"isAiGenerated":false},"b100b37a-57ff-482e-8f82-f44ec854a738":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a8d6edd-262f-477e-8363-2ee4263c9ada","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"e6301f1b-1b38-4466-b3e7-424594e1579b","$typeOfContent":"","type":"SetVariable","$title":"Set  \"0\" to variable \"countError\"","$invalid":false,"settings":{"variable":"countError","value":"0"},"conditions":[]},{"$id":"a583d725-4b65-4a0d-9a23-c0c2905ecb83","$typeOfContent":"","type":"SetVariable","$title":"Set \"true\" to variable \"persistentReturn\"","$invalid":false,"settings":{"variable":"persistentReturn","value":"true"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-8ebb68c2-c363-1ef5-3aa1-8834c271535a","canChangeBackground":false},{"id":"blip-tag-3314d6c5-d2c5-4527-9f7d-2b77e5d1eb5b","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"b100b37a-57ff-482e-8f82-f44ec854a738","root":false,"$title":"[Go to] Previous block","$position":{"top":"608px","left":"1307px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"f3d01d60-2371-4088-8d03-603cd8802385":{"$contentActions":[{"action":{"$id":"fcbc85ac-81b8-416e-9b62-7c1595d73245","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8e226fce-4585-42bf-b2e2-2abbabd7586f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8e226fce-4585-42bf-b2e2-2abbabd7586f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"216443c7-b60f-4eaa-9297-1c76af047f30","$typeOfContent":"raw-content","type":"SendRawMessage","settings":{"metadata":{},"type":"{{menuPayload@type}}","rawContent":"{{menuPayload@content}}"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2173c76c-10c6-425e-8e97-767437d59c81","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"expiration":"0:30"},"$invalid":false}],"$conditionOutputs":[{"stateId":"5511d309-7014-4923-9190-b3e70731d55b","typeOfStateId":"state","$connId":"con_58","$id":"058a4a88-d5e6-4af3-9060-23e4a1411f18","conditions":[{"source":"context","comparison":"equals","values":["Finalizar conversa"],"variable":"processedInput"}],"$invalid":false},{"stateId":"b100b37a-57ff-482e-8f82-f44ec854a738","typeOfStateId":"state","$connId":"con_63","$id":"64b4a854-a468-4633-a3ca-bf5002087dd6","conditions":[{"source":"context","comparison":"equals","values":["Tentar novamente"],"variable":"processedInput"}],"$invalid":false},{"stateId":"b8619734-ddb6-46b0-9567-2f8acfbf19bf","typeOfStateId":"state","$connId":"con_68","$id":"dc946d33-03b5-497d-b886-059a45e46717","conditions":[{"source":"context","comparison":"equals","values":["Falar com atendente"],"variable":"processedInput@data"}],"$isBuilderDefaultOutput":true,"$invalid":false}],"$enteringCustomActions":[{"$id":"b75932b6-82a4-43fa-8fae-106ffa044c8f","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"menuPayload\"","$invalid":false,"settings":{"function":"run","source":"{{resource.FunctionGetMenu}}\n\nfunction run(boldTags, platform) {\n    let platformInLowerCase = platform.toLowerCase()\n\n    if (platformInLowerCase == 'instagram' || platformInLowerCase == 'telegram' || platformInLowerCase == 'messenger') {\n        platformInLowerCase = 'blipchat'\n    }\n\n    /*\n    ** Tornando o JSON \"boldTags\" acess칤vel para ser enviado como par칙metro \n    ** na constante \"dynamicMenuBuildingDetails\"\n    */\n    boldTags = JSON.parse(boldTags)\n\n    const { open, close } = boldTags\n\n    const dynamicMenuBuildingDetails = {\n        \"text\": `Desculpa, n칚o estou entendendo o que voc칡 quer dizer... 游땞\\n\\n${open}O que voc칡 prefere fazer?${close}\\n\\nClique em uma das op칞칫es a seguir 游녢`,\n        \"header\": '',\n        \"body\": `Desculpa, n칚o estou entendendo o que voc칡 quer dizer... 游땞\\n\\n${open}O que voc칡 prefere fazer?${close}\\n\\nClique em uma das op칞칫es a seguir 游녢`,\n        \"footer\": '',\n        \"button\": '',\n        \"title\": '',\n        \"namespaceTemplate\": '',\n        \"nameTemplate\": '',\n        \"options\": ['Menu inicial', 'Falar com atendente', 'Finalizar conversa'],\n        \"values\": ['Menu inicial', 'Falar com atendente', 'Finalizar conversa'],\n        \"description\": [],\n        \"menuScope\": {\n            \"whatsappButton\": true,\n            \"whatsappList\": false,\n            \"whatsappTemplate\": false,\n            \"blipchatQuickReply\": true,\n            \"blipchatMenu\": false,\n            \"defaultText\": false,\n            \"platform\": platformInLowerCase,\n            \"boldValue\": boldTags,\n        },\n    }\n\n    const dinamycMenuSchema = getMenuForPlatform(dynamicMenuBuildingDetails)\n\n    return dinamycMenuSchema\n}","inputVariables":["boldTags","platform"],"outputVariable":"menuPayload","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"d9a663a7-b1a6-4342-9816-05d95f973920","$typeOfContent":"","type":"TrackEvent","$title":"Erro persistente exibicao","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"Erro persistente exibicao","action":"Exibicao"},"conditions":[]},{"$id":"21870ad0-36bf-4e8d-97d2-3430dfe334e4","$typeOfContent":"","type":"TrackEvent","$title":"Erro persistente origem","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"Erro persistente origem","action":"{{returnService}} | {{flow@blockOrigin}}"},"conditions":[]}],"$leavingCustomActions":[{"$id":"373629c9-6fb6-41bb-a198-4da463dc191e","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"processedInput\"","$invalid":false,"settings":{"function":"run","source":"function run(userContent, userContentType) {\n    try {\n        if (!userContent) throw new Error('inatividade')\n\n        if (userContentType !== \"text/plain\") throw new Error('input inesperado')\n\n        const menuOptions = {\n            \"1\": \"Tentar novamente\",\n            \"2\": \"Falar com atendente\",\n            \"3\": \"Finalizar conversa\"\n        }\n\n        const menuRegex = {\n            \"1\": \"^1$|^um$|^primeiro$|Tentar novamente\",\n            \"2\": \"^2$|^dois$|^segundo$|Falar com atendente\",\n            \"3\": \"^3$|^tr[e칡]s$|^terceiro$|Finalizar conversa\",\n        }\n\n        for (const prop in menuRegex) {\n            const regexOption = new RegExp(menuRegex[prop], \"igm\")\n\n            if (regexOption.test(userContent)) {\n                return JSON.stringify({\n                    success: true,\n                    data: menuOptions[prop],\n                    input: userContent,\n                    message: 'v치lido'\n                }, null, 2)\n            }\n        }\n\n        throw new Error('input inesperado')\n    } catch (error) {\n        return JSON.stringify({\n            success: false,\n            data: error.message,\n            input: userContent || error.message,\n            message: 'inv치lido'\n        }, null, 2)\n    }\n}","inputVariables":["input.content","input.type"],"outputVariable":"processedInput","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"684ee81a-61d8-444a-bac2-6e64ceda4b13","$typeOfContent":"","type":"TrackEvent","$title":"Erro persistente selecao","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"Erro persistente selecao","action":"{{processedInput}}"},"conditions":[{"values":["input inesperado"],"source":"context","variable":"processedInput","comparison":"notEquals"}]},{"$id":"0e7844d4-bedf-48ca-9448-594dd0eba37d","$typeOfContent":"","type":"TrackEvent","$title":"Erro persistente inesperado","$invalid":false,"settings":{"extras":{"Headline An칰ncio":"{{metadata@headline}}","Id do An칰ncio":"{{metadata@source_id}}","Url do An칰ncio":"{{metadata@source_url}}"},"category":"Erro persistente inesperado","action":"{{input.content}}"},"conditions":[{"source":"input","comparison":"exists","values":[]},{"source":"context","comparison":"equals","variable":"processedInput","values":["input inesperado"]}]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"5511d309-7014-4923-9190-b3e70731d55b","$invalid":false,"typeOfStateId":"state"},"$tags":[{"id":"blip-tag-40cf9276-e4f8-4631-bb88-bebea97bb0a6","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-93ff37b2-406f-42ca-a6c8-c216ab8f1dca","label":"TrackEvent","background":"#61D36F","canChangeBackground":false},{"id":"blip-tag-7991ad17-3fff-47d2-85c4-c5f3698b6f73","label":"SendMessage","background":"#EE82EE","canChangeBackground":false},{"id":"blip-tag-6561ac3e-3ea6-4ebe-be6f-2b65ecb43161","label":"UserInput","background":"#000000","canChangeBackground":false}],"id":"f3d01d60-2371-4088-8d03-603cd8802385","root":false,"$title":"[CV.2.0.0] [Menu] [Input] [Val]","$position":{"top":"607px","left":"1105px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"isAiGenerated":false},"b8619734-ddb6-46b0-9567-2f8acfbf19bf":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"2a8d6edd-262f-477e-8363-2ee4263c9ada","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"56545979-88cf-4fa4-9a6c-193594effaaa","$typeOfContent":"","type":"SetVariable","$title":"Set \"lastBlock\" to blip variable \"state.previous.name\"","$invalid":false,"settings":{"variable":"lastBlock","value":"{{state.previous.name}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"71afcd40-1e74-486c-9151-2309da18e58f","$invalid":false,"typeOfStateId":"state"},"$tags":[{"background":"#0A6045","label":"Go to","id":"blip-tag-8ebb68c2-c363-1ef5-3aa1-8834c271535a","canChangeBackground":false},{"id":"blip-tag-241a5d30-1fa6-402e-949b-1f141de8dc0d","label":"SetVariable","background":"#FF4A1E","canChangeBackground":false}],"id":"b8619734-ddb6-46b0-9567-2f8acfbf19bf","root":false,"$title":"[Go to] Transbordo","$position":{"top":"471px","left":"1105px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false,"addonsSettings":{"backgroundColor":"#fff9c4","commentsIdList":[],"textColor":"#000000"},"isAiGenerated":false},"71afcd40-1e74-486c-9151-2309da18e58f":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"e04bed4d-5164-4c65-ab5e-beedcbc58a69","type":"text/plain","textContent":"Entrada do usu치rio","content":"Entrada do usu치rio"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"7c2ffe51-2436-4a13-9394-936cd3b4c0ad","$typeOfContent":"","type":"ExecuteScript","$title":"Run script \"redirectMessage\"","$invalid":false,"settings":{"function":"run","source":"function run(lastBlock) {\n    const message = {\n        flow: {\n            origin: \"excecoes\",\n            blockOrigin: lastBlock,\n        },\n        service: \"transbordo\",\n        destinyBlock: \"default\",\n    };\n\n    return JSON.stringify(message)\n}","inputVariables":["lastBlock"],"outputVariable":"redirectMessage","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[{"$id":"d590a51c-5cdb-4d64-b0fe-165e94ee8dba","$typeOfContent":"","type":"Redirect","$title":"Redirect to \"Finalizacao\"","$invalid":false,"settings":{"context":{"type":"text/plain","value":"{{redirectMessage}}"},"address":"{{redirectMessage@service}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"isAiGenerated":false,"$tags":[{"id":"blip-tag-297caaec-c308-4a72-bcb6-1494f91af03c","label":"ExecuteScript","background":"#FF961E","canChangeBackground":false},{"id":"blip-tag-ea9391f4-dd32-476e-8b22-f8b52e5b4545","label":"Redirect","background":"#1EA1FF","canChangeBackground":false}],"id":"71afcd40-1e74-486c-9151-2309da18e58f","root":false,"$title":"[Redirect to] Transbordo","$position":{"top":"649px","left":"227px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}